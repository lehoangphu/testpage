{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 4a53b6ec21c177e93c8b","webpack:///./src/cottontail.js","webpack:///./src/core/node.js","webpack:///./src/core/ray.js","webpack:///./src/core/renderer.js","webpack:///./src/core/material.js","webpack:///./src/core/program.js","webpack:///./src/core/texture.js","webpack:///./src/geometry/primitive-stream.js","webpack:///./src/core/primitive.js","webpack:///./src/geometry/box-builder.js","webpack:///./src/materials/pbr.js","webpack:///./src/nodes/button.js","webpack:///./src/nodes/cube-sea.js","webpack:///./src/nodes/gltf2.js","webpack:///./src/loaders/gltf2.js","webpack:///./src/nodes/skybox.js","webpack:///./src/nodes/video.js","webpack:///./src/scenes/scene.js","webpack:///./src/nodes/bounds-renderer.js","webpack:///./src/nodes/input-renderer.js","webpack:///./src/nodes/stats-viewer.js","webpack:///./src/nodes/seven-segment-text.js"],"names":["window","XRWebGLLayer","prototype","getViewport","view","Node","Renderer","createWebGLContext","UrlTexture","PrimitiveStream","BoxBuilder","PbrMaterial","ButtonNode","CubeSeaNode","Gltf2Node","SkyboxNode","VideoNode","WebXRView","Scene","DEFAULT_TRANSLATION","Float32Array","DEFAULT_ROTATION","DEFAULT_SCALE","tmpRayMatrix","mat4","create","tmpRayOrigin","vec3","name","children","parent","visible","selectable","_matrix","_dirtyTRS","_translation","_rotation","_scale","_dirtyWorldMatrix","_worldMatrix","_activeFrameId","_hoverFrameId","_renderPrimitives","_renderer","_selectHandler","renderer","clearRenderPrimitives","onRendererChanged","child","_setRenderer","cloneNode","copy","quat","waitForComplete","then","primitive","addRenderPrimitive","addNode","clone","frameId","markActive","value","removeNode","push","i","indexOf","splice","setMatrixDirty","fromRotationTranslationScale","childPromises","Promise","all","_instances","index","length","rayMatrix","ray","_min","invert","worldMatrix","multiply","intersection","intersectsAABB","_max","transformMat4","_hitTestSelectableNode","rayOrigin","set","node","distance","result","childResult","hitTest","timestamp","frameDelta","onUpdate","_update","_updateLocalMatrix","mul","normalMat","mat3","RAY_INTERSECTION_OFFSET","Ray","matrix","origin","_dir","fromMat4","transformMat3","dir","min","max","r","bounds","tmin","sign","inv_dir","tmax","tymin","tymax","tzmin","tzmax","t","Math","intersectionPoint","scale","add","normalize","fromValues","ATTRIB","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","ATTRIB_MASK","GL","WebGLRenderingContext","DEF_LIGHT_DIR","DEF_LIGHT_COLOR","PRECISION_REGEX","RegExp","VERTEX_SHADER_SINGLE_ENTRY","VERTEX_SHADER_MULTI_ENTRY","FRAGMENT_SHADER_ENTRY","isPowerOfTwo","n","glAttribs","alpha","webglCanvas","document","createElement","contextTypes","webgl2","context","contextType","getContext","webglType","console","error","RenderView","projectionMatrix","viewMatrix","viewport","eye","_eye","_eyeIndex","RenderBuffer","target","usage","buffer","_target","_usage","_length","_buffer","_promise","resolve","RenderPrimitiveAttribute","primitiveAttribute","_attrib_index","_componentCount","componentCount","_componentType","componentType","_stride","stride","_byteOffset","byteOffset","_normalized","normalized","RenderPrimitiveAttributeBuffer","_attributes","RenderPrimitive","_material","setPrimitive","_mode","mode","_elementCount","elementCount","_vao","_complete","_attributeBuffers","_attributeMask","attributes","attribute","renderAttribute","foundBuffer","attributeBuffer","_indexBuffer","_indexByteOffset","_indexType","indexBuffer","indexByteOffset","indexType","material","program","reject","completionPromises","_samplerDictionary","_uniform_dictionary","inverseMatrix","setCap","gl","glEnum","cap","prevState","state","change","enable","disable","RenderMaterialSampler","materialSampler","_uniformName","_texture","_getRenderTexture","_index","RenderMaterialUniform","materialUniform","_uniform","_value","Array","RenderMaterial","_program","_state","_samplers","renderSampler","_uniforms","uniform","renderUniform","_completePromise","_firstBind","_renderOrder","renderOrder","DEFAULT","BLEND","TRANSPARENT","OPAQUE","sampler","activeTexture","TEXTURE0","bindTexture","TEXTURE_2D","uniform1fv","uniform2fv","uniform3fv","uniform4fv","promises","otherState","CAPS_RANGE","BLEND_FUNC_RANGE","DEPTH_TEST","DEPTH_FUNC_RANGE","CULL_FACE","STENCIL_TEST","COLOR_MASK","DEPTH_MASK","STENCIL_MASK","DEPTH_FUNC_SHIFT","NEVER","BLEND_SRC_RANGE","BLEND_SRC_SHIFT","BLEND_DST_RANGE","BLEND_DST_SHIFT","_gl","_frameId","_programCache","_textureCache","_cameraPositions","_vaoExt","getExtension","fragHighPrecision","getShaderPrecisionFormat","FRAGMENT_SHADER","HIGH_FLOAT","_defaultFragPrecision","precision","_depthMaskNeedsReset","_colorMaskNeedsReset","data","STATIC_DRAW","glBuffer","createBuffer","renderBuffer","bindBuffer","bufferData","byteLength","offset","bufferSubData","updateRenderBuffer","renderPrimitive","_getMaterialProgram","renderMaterial","setRenderMaterial","meshNode","createRenderPrimitive","views","rootNode","vp","x","y","width","height","cameraPosition","renderPrimitives","_drawRenderPrimitiveSet","bindVertexArrayOES","depthMask","colorMask","attribMask","use","LIGHT_DIRECTION","LIGHT_COLOR","uniformMatrix4fv","PROJECTION_MATRIX","VIEW_MATRIX","CAMERA_POSITION","uniform1i","EYE_INDEX","eyeIndex","_bindMaterialState","bind","createVertexArrayOES","_bindPrimitive","instance","MODEL_MATRIX","drawElements","drawArrays","texture","key","textureKey","Error","textureHandle","updateVideoFrame","_video","paused","waiting","texImage2D","format","UNSIGNED_BYTE","source","setTimeout","createTexture","_type","_data","_setSamplerParameters","addEventListener","powerOfTwo","mipmap","generateMipmap","minFilter","LINEAR_MIPMAP_LINEAR","LINEAR","wrapS","REPEAT","CLAMP_TO_EDGE","wrapT","texParameteri","TEXTURE_MAG_FILTER","magFilter","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","TEXTURE_WRAP_T","defines","define","materialName","vertexSource","fragmentSource","getProgramDefines","_getProgramKey","multiview","fullVertexSource","precisionMatch","match","fragPrecisionHeader","fullFragmentSource","onNextUse","attrib","enableVertexAttribArray","disableVertexAttribArray","ARRAY_BUFFER","vertexAttribPointer","ELEMENT_ARRAY_BUFFER","prevMaterial","_capsDiff","colorMaskChange","mask","depthMaskChange","stencilMaskChange","stencilMask","_blendDiff","blendFunc","blendFuncSrc","blendFuncDst","_depthFuncDiff","depthFunc","stateToBlendFunc","CAP","MAT_STATE","RENDER_ORDER","SKY","ADDITIVE","shift","SRC_COLOR","MaterialState","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","LESS","MaterialSampler","uniformName","MaterialUniform","defaultValue","Material","Program","vertSrc","fragSrc","attribMap","createProgram","_firstUse","_nextUseCallbacks","definesString","_vertShader","createShader","VERTEX_SHADER","attachShader","shaderSource","compileShader","_fragShader","attribName","bindAttribLocation","linkProgram","callback","getProgramParameter","LINK_STATUS","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","getProgramInfoLog","deleteProgram","attribCount","ACTIVE_ATTRIBUTES","attribInfo","getActiveAttrib","getAttribLocation","uniformCount","ACTIVE_UNIFORMS","uniformInfo","getActiveUniform","replace","getUniformLocation","deleteShader","useProgram","TextureSampler","Texture","RGBA","ImageTexture","img","_img","src","complete","naturalWidth","url","Image","BlobTexture","blob","URL","createObjectURL","VideoTexture","video","readyState","videoWidth","videoHeight","nextDataTextureIndex","DataTexture","type","_width","_height","_format","_key","ColorTexture","g","b","a","colorData","Uint8Array","tempVec3","options","_vertices","_indices","_geometryStarted","_vertexOffset","_vertexIndex","_highIndex","_flipWinding","_invertNormals","_transform","_normalTransform","z","u","v","nx","ny","nz","idxA","idxB","idxC","vertexBuffer","createRenderBuffer","Uint16Array","attribs","FLOAT","setIndexBuffer","setBounds","GeometryBuilderBase","primitiveStream","_stream","finishPrimitive","clear","PrimitiveAttribute","Primitive","stream","w","h","d","wh","hh","dh","cx","cy","cz","startGeometry","idx","nextVertexIndex","pushTriangle","pushVertex","endGeometry","center","size","hs","pushBox","VERTEX_SOURCE","EPIC_PBR_FUNCTIONS","FRAGMENT_SOURCE","baseColor","defineSampler","metallicRoughness","normal","occlusion","emissive","baseColorFactor","defineUniform","metallicRoughnessFactor","occlusionStrength","emissiveFactor","programDefines","BUTTON_SIZE","BUTTON_CORNER_RADIUS","BUTTON_CORNER_SEGMENTS","BUTTON_ICON_SIZE","BUTTON_LAYER_DISTANCE","BUTTON_COLOR","BUTTON_ALPHA","BUTTON_HOVER_COLOR","BUTTON_HOVER_ALPHA","BUTTON_HOVER_SCALE","BUTTON_HOVER_TRANSITION_TIME_MS","ButtonMaterial","blend","ButtonIconMaterial","icon","iconTexture","_iconTexture","_hovered","_hoverT","hd","ihs","segments","rad","PI","cos","sin","section","floor","buttonPrimitive","_buttonRenderPrimitive","iconPrimitive","iconMaterial","_iconRenderPrimitive","hoverAmount","uniforms","_updateHoverState","samplers","CubeSeaMaterial","heavy","heavyGpu","cubeCount","cubeScale","halfOnly","autoRotate","imageUrl","_renderPrimitive","boxBuilder","pushCube","heroPrimitive","heroNode","createMesh","rebuildCubes","cubeSeaNode","halfGrid","pos","cubeSeaPrimitive","fromRotation","gltfLoaderMap","WeakMap","_url","_resolver","_rejecter","loader","get","_ensurePromise","loadFromUrl","sceneNode","catch","err","GLB_MAGIC","CHUNK_TYPE","JSON","BIN","isAbsoluteUri","uri","absRegEx","location","protocol","isDataUri","dataRegEx","resolveUri","baseUrl","getComponentCount","Gltf2Loader","fetch","response","lastIndexOf","substring","endsWith","json","loadFromJson","arrayBuffer","loadFromBinary","headerView","DataView","magic","getUint32","version","chunks","chunkOffset","chunkHeaderView","chunkLength","chunkType","slice","decoder","TextDecoder","jsonString","decode","parse","binaryChunk","asset","minVersion","buffers","Gltf2Resource","bufferViews","bufferView","Gltf2BufferView","images","image","textures","glTexture","getTexture","textureInfo","materials","glMaterial","pbr","pbrMetallicRoughness","baseColorTexture","metallicFactor","roughnessFactor","metallicRoughnessTexture","normalTexture","occlusionTexture","strength","emissiveTexture","alphaMode","cullFace","doubleSided","accessors","meshes","mesh","glMesh","Gltf2Mesh","primitives","accessor","count","glAttribute","byteStride","glPrimitive","indices","scene","scenes","nodes","nodeId","processNodes","glNode","translation","rotation","_viewPromise","_renderBuffer","dataView","_dataPromise","base64String","binaryArray","from","atob","c","charCodeAt","Blob","mimeType","SkyboxMaterial","LEQUAL","texCoordScaleOffset","_displayMode","displayMode","_rotationY","rotationY","vertices","latSegments","lonSegments","theta","sinTheta","cosTheta","idxOffsetA","idxOffsetB","j","phi","VideoMaterial","_video_texture","pose","layer","getViewMatrix","_timestamp","_frameDelta","_statsStanding","_stats","_statsEnabled","enableStats","_stageBounds","_boundsRenderer","_inputRenderer","_resetInputEndFrame","_lastTimestamp","_hoverFrame","_hoveredNodes","clearColor","frame","frameOfRef","session","getInputSources","inputSources","newHoveredNodes","lastHoverFrame","inputSource","inputPose","getInputPose","gripMatrix","inputRenderer","addController","pointerMatrix","pointerOrigin","addLaserPointer","hitResult","addCursor","onHoverStart","cursorPos","hoverNode","onHoverEnd","handleSelectPointer","handleSelect","fromEuler","stageBounds","drawViewArray","xrFrame","baseLayer","bindFramebuffer","FRAMEBUFFER","framebuffer","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","drawViews","prevTimestamp","performance","now","begin","reset","end","BoundsMaterial","ONE","depthTest","BoundsRenderer","verts","pointCount","geometry","point","LASER_TEXTURE_DATA","LASER_LENGTH","LASER_DIAMETER","LASER_FADE_END","LASER_FADE_POINT","LASER_DEFAULT_COLOR","CURSOR_RADIUS","CURSOR_SHADOW_RADIUS","CURSOR_SHADOW_INNER_LUMINANCE","CURSOR_SHADOW_OUTER_LUMINANCE","CURSOR_SHADOW_INNER_OPACITY","CURSOR_SHADOW_OUTER_OPACITY","CURSOR_OPACITY","CURSOR_SEGMENTS","CURSOR_DEFAULT_COLOR","CURSOR_DEFAULT_HIDDEN_COLOR","DEFAULT_RESET_OPTIONS","controllers","lasers","cursors","LaserMaterial","laser","laserColor","CURSOR_VERTEX_SHADER","CURSOR_FRAGMENT_SHADER","CursorMaterial","cursorColor","CursorHiddenMaterial","GEQUAL","InputRenderer","_maxInputElements","_controllers","_controllerNode","_controllerNodeHandedness","_lasers","_cursors","_activeControllers","_activeLasers","_activeCursors","controllerNode","handedness","controller","_createLaserMesh","_createCursorMesh","cursor","lr","ll","laserVerts","laserIndices","laserVertexBuffer","laserIndexBuffer","laserIndexCount","laserAttribs","laserPrimitive","laserMaterial","laserRenderPrimitive","cursorVerts","cursorIndices","segRad","indexOffset","cursorVertexBuffer","cursorIndexBuffer","cursorIndexCount","cursorAttribs","cursorPrimitive","cursorMaterial","cursorHiddenMaterial","cursorRenderPrimitive","cursorHiddenRenderPrimitive","SEGMENTS","MAX_FPS","StatsMaterial","segmentToX","fpsToY","fpsToRGB","Date","StatsViewer","_performanceMonitoring","_startTime","_prevFrameTime","_prevGraphUpdateTime","_frames","_fpsAverage","_fpsMin","_fpsStep","_lastSegment","_fpsVertexBuffer","_fpsRenderPrimitive","_fpsNode","_sevenSegmentNode","clearNodes","fpsVerts","fpsIndices","addBGSquare","left","bottom","right","top","DYNAMIC_DRAW","fpsIndexBuffer","fpsAttribs","fpsPrimitive","time","frameFps","intervalTime","round","_updateGraph","log","valueLow","valueHigh","color","y0","y1","updateVerts","text","TEXT_KERNING","SevenSegmentMaterial","SevenSegmentText","_text","_charNodes","segmentIndices","thickness","defineSegment","id","characters","defineCharacter","character","segment","vertexAttribs","_charPrimitives","char","charDef","charPrimitive"],"mappings":"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","file":"cottontail.debug.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4a53b6ec21c177e93c8b","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {Node} from './core/node.js';\nimport {Renderer, createWebGLContext} from './core/renderer.js';\nimport {UrlTexture} from './core/texture.js';\n\nimport {PrimitiveStream} from './geometry/primitive-stream.js';\nimport {BoxBuilder} from './geometry/box-builder.js';\n\nimport {PbrMaterial} from './materials/pbr.js';\n\nimport {ButtonNode} from './nodes/button.js';\nimport {CubeSeaNode} from './nodes/cube-sea.js';\nimport {Gltf2Node} from './nodes/gltf2.js';\nimport {SkyboxNode} from './nodes/skybox.js';\nimport {VideoNode} from './nodes/video.js';\n\nimport {WebXRView, Scene} from './scenes/scene.js';\n\n// A very short-term polyfill to address a change in the location of the\n// getViewport call. This should dissapear within a month or so.\nif (('XRWebGLLayer' in window) && !('getViewport' in XRWebGLLayer.prototype)) {\n  XRWebGLLayer.prototype.getViewport = function(view) {\n    return view.getViewport(this);\n  };\n}\n\nexport {\n  Node,\n  Renderer,\n  createWebGLContext,\n  UrlTexture,\n\n  PrimitiveStream,\n  BoxBuilder,\n\n  PbrMaterial,\n\n  ButtonNode,\n  CubeSeaNode,\n  Gltf2Node,\n  SkyboxNode,\n  VideoNode,\n\n  WebXRView,\n  Scene,\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/cottontail.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {Ray} from './ray.js';\n\nconst DEFAULT_TRANSLATION = new Float32Array([0, 0, 0]);\nconst DEFAULT_ROTATION = new Float32Array([0, 0, 0, 1]);\nconst DEFAULT_SCALE = new Float32Array([1, 1, 1]);\n\nlet tmpRayMatrix = mat4.create();\nlet tmpRayOrigin = vec3.create();\n\nexport class Node {\n  constructor() {\n    this.name = null; // Only for debugging\n    this.children = [];\n    this.parent = null;\n    this.visible = true;\n    this.selectable = false;\n\n    this._matrix = null;\n\n    this._dirtyTRS = false;\n    this._translation = null;\n    this._rotation = null;\n    this._scale = null;\n\n    this._dirtyWorldMatrix = false;\n    this._worldMatrix = null;\n\n    this._activeFrameId = -1;\n    this._hoverFrameId = -1;\n    this._renderPrimitives = null;\n    this._renderer = null;\n\n    this._selectHandler = null;\n  }\n\n  _setRenderer(renderer) {\n    if (this._renderer == renderer) {\n      return;\n    }\n\n    if (this._renderer) {\n      // Changing the renderer removes any previously attached renderPrimitives\n      // from a different renderer.\n      this.clearRenderPrimitives();\n    }\n\n    this._renderer = renderer;\n    if (renderer) {\n      this.onRendererChanged(renderer);\n\n      for (let child of this.children) {\n        child._setRenderer(renderer);\n      }\n    }\n  }\n\n  onRendererChanged(renderer) {\n    // Override in other node types to respond to changes in the renderer.\n  }\n\n  // Create a clone of this node and all of it's children. Does not duplicate\n  // RenderPrimitives, the cloned nodes will be treated as new instances of the\n  // geometry.\n  clone() {\n    let cloneNode = new Node();\n    cloneNode.name = this.name;\n    cloneNode.visible = this.visible;\n    cloneNode._renderer = this._renderer;\n\n    cloneNode._dirtyTRS = this._dirtyTRS;\n\n    if (this._translation) {\n      cloneNode._translation = vec3.create();\n      vec3.copy(cloneNode._translation, this._translation);\n    }\n\n    if (this._rotation) {\n      cloneNode._rotation = quat.create();\n      quat.copy(cloneNode._rotation, this._rotation);\n    }\n\n    if (this._scale) {\n      cloneNode._scale = vec3.create();\n      vec3.copy(cloneNode._scale, this._scale);\n    }\n\n    // Only copy the matrices if they're not already dirty.\n    if (!cloneNode._dirtyTRS && this._matrix) {\n      cloneNode._matrix = mat4.create();\n      mat4.copy(cloneNode._matrix, this._matrix);\n    }\n\n    cloneNode._dirtyWorldMatrix = this._dirtyWorldMatrix;\n    if (!cloneNode._dirtyWorldMatrix && this._worldMatrix) {\n      cloneNode._worldMatrix = mat4.create();\n      mat4.copy(cloneNode._worldMatrix, this._worldMatrix);\n    }\n\n    this.waitForComplete().then(() => {\n      if (this._renderPrimitives) {\n        for (let primitive of this._renderPrimitives) {\n          cloneNode.addRenderPrimitive(primitive);\n        }\n      }\n\n      for (let child of this.children) {\n        cloneNode.addNode(child.clone());\n      }\n    });\n\n    return cloneNode;\n  }\n\n  markActive(frameId) {\n    if (this.visible && this._renderPrimitives) {\n      this._activeFrameId = frameId;\n      for (let primitive of this._renderPrimitives) {\n        primitive.markActive(frameId);\n      }\n    }\n\n    for (let child of this.children) {\n      if (child.visible) {\n        child.markActive(frameId);\n      }\n    }\n  }\n\n  addNode(value) {\n    if (!value || value.parent == this) {\n      return;\n    }\n\n    if (value.parent) {\n      value.parent.removeNode(value);\n    }\n    value.parent = this;\n\n    this.children.push(value);\n\n    if (this._renderer) {\n      value._setRenderer(this._renderer);\n    }\n  }\n\n  removeNode(value) {\n    let i = this.children.indexOf(value);\n    if (i > -1) {\n      this.children.splice(i, 1);\n      value.parent = null;\n    }\n  }\n\n  clearNodes() {\n    for (let child of this.children) {\n      child.parent = null;\n    }\n    this.children = [];\n  }\n\n  setMatrixDirty() {\n    if (!this._dirtyWorldMatrix) {\n      this._dirtyWorldMatrix = true;\n      for (let child of this.children) {\n        child.setMatrixDirty();\n      }\n    }\n  }\n\n  _updateLocalMatrix() {\n    if (!this._matrix) {\n      this._matrix = mat4.create();\n    }\n\n    if (this._dirtyTRS) {\n      this._dirtyTRS = false;\n      mat4.fromRotationTranslationScale(\n        this._matrix,\n        this._rotation || DEFAULT_ROTATION,\n        this._translation || DEFAULT_TRANSLATION,\n        this._scale || DEFAULT_SCALE);\n    }\n\n    return this._matrix;\n  }\n\n  set matrix(value) {\n    this._matrix = value;\n    this.setMatrixDirty();\n    this._dirtyTRS = false;\n    this._translation = null;\n    this._rotation = null;\n    this._scale = null;\n  }\n\n  get matrix() {\n    this.setMatrixDirty();\n\n    return this._updateLocalMatrix();\n  }\n\n  get worldMatrix() {\n    if (!this._worldMatrix) {\n      this._dirtyWorldMatrix = true;\n      this._worldMatrix = mat4.create();\n    }\n\n    if (this._dirtyWorldMatrix || this._dirtyTRS) {\n      if (this.parent) {\n        // TODO: Some optimizations that could be done here if the node matrix\n        // is an identity matrix.\n        mat4.mul(this._worldMatrix, this.parent.worldMatrix, this._updateLocalMatrix());\n      } else {\n        mat4.copy(this._worldMatrix, this._updateLocalMatrix());\n      }\n      this._dirtyWorldMatrix = false;\n    }\n\n    return this._worldMatrix;\n  }\n\n  // TODO: Decompose matrix when fetching these?\n  set translation(value) {\n    if (value != null) {\n      this._dirtyTRS = true;\n      this.setMatrixDirty();\n    }\n    this._translation = value;\n  }\n\n  get translation() {\n    this._dirtyTRS = true;\n    this.setMatrixDirty();\n    if (!this._translation) {\n      this._translation = vec3.clone(DEFAULT_TRANSLATION);\n    }\n    return this._translation;\n  }\n\n  set rotation(value) {\n    if (value != null) {\n      this._dirtyTRS = true;\n      this.setMatrixDirty();\n    }\n    this._rotation = value;\n  }\n\n  get rotation() {\n    this._dirtyTRS = true;\n    this.setMatrixDirty();\n    if (!this._rotation) {\n      this._rotation = quat.clone(DEFAULT_ROTATION);\n    }\n    return this._rotation;\n  }\n\n  set scale(value) {\n    if (value != null) {\n      this._dirtyTRS = true;\n      this.setMatrixDirty();\n    }\n    this._scale = value;\n  }\n\n  get scale() {\n    this._dirtyTRS = true;\n    this.setMatrixDirty();\n    if (!this._scale) {\n      this._scale = vec3.clone(DEFAULT_SCALE);\n    }\n    return this._scale;\n  }\n\n  waitForComplete() {\n    let childPromises = [];\n    for (let child of this.children) {\n      childPromises.push(child.waitForComplete());\n    }\n    if (this._renderPrimitives) {\n      for (let primitive of this._renderPrimitives) {\n        childPromises.push(primitive.waitForComplete());\n      }\n    }\n    return Promise.all(childPromises).then(() => this);\n  }\n\n  get renderPrimitives() {\n    return this._renderPrimitives;\n  }\n\n  addRenderPrimitive(primitive) {\n    if (!this._renderPrimitives) {\n      this._renderPrimitives = [primitive];\n    } else {\n      this._renderPrimitives.push(primitive);\n    }\n    primitive._instances.push(this);\n  }\n\n  removeRenderPrimitive(primitive) {\n    if (!this._renderPrimitives) {\n      return;\n    }\n\n    let index = this._renderPrimitives._instances.indexOf(primitive);\n    if (index > -1) {\n      this._renderPrimitives._instances.splice(index, 1);\n\n      index = primitive._instances.indexOf(this);\n      if (index > -1) {\n        primitive._instances.splice(index, 1);\n      }\n\n      if (!this._renderPrimitives.length) {\n        this._renderPrimitives = null;\n      }\n    }\n  }\n\n  clearRenderPrimitives() {\n    if (this._renderPrimitives) {\n      for (let primitive of this._renderPrimitives) {\n        let index = primitive._instances.indexOf(this);\n        if (index > -1) {\n          primitive._instances.splice(index, 1);\n        }\n      }\n      this._renderPrimitives = null;\n    }\n  }\n\n  _hitTestSelectableNode(rayMatrix) {\n    if (this._renderPrimitives) {\n      let ray = null;\n      for (let primitive of this._renderPrimitives) {\n        if (primitive._min) {\n          if (!ray) {\n            mat4.invert(tmpRayMatrix, this.worldMatrix);\n            mat4.multiply(tmpRayMatrix, tmpRayMatrix, rayMatrix);\n            ray = new Ray(tmpRayMatrix);\n          }\n          let intersection = ray.intersectsAABB(primitive._min, primitive._max);\n          if (intersection) {\n            vec3.transformMat4(intersection, intersection, this.worldMatrix);\n            return intersection;\n          }\n        }\n      }\n    }\n    for (let child of this.children) {\n      let intersection = child._hitTestSelectableNode(rayMatrix);\n      if (intersection) {\n        return intersection;\n      }\n    }\n    return null;\n  }\n\n  hitTest(rayMatrix, rayOrigin = null) {\n    if (!rayOrigin) {\n      rayOrigin = tmpRayOrigin;\n      vec3.set(rayOrigin, 0, 0, 0);\n      vec3.transformMat4(rayOrigin, rayOrigin, rayMatrix);\n    }\n\n    if (this.selectable && this.visible) {\n      let intersection = this._hitTestSelectableNode(rayMatrix);\n      if (intersection) {\n        return {\n          node: this,\n          intersection: intersection,\n          distance: vec3.distance(rayOrigin, intersection),\n        };\n      }\n      return null;\n    }\n\n    let result = null;\n    for (let child of this.children) {\n      let childResult = child.hitTest(rayMatrix, rayOrigin);\n      if (childResult) {\n        if (!result || result.distance > childResult.distance) {\n          result = childResult;\n        }\n      }\n    }\n    return result;\n  }\n\n  onSelect(value) {\n    this._selectHandler = value;\n  }\n\n  get selectHandler() {\n    return this._selectHandler;\n  }\n\n  // Called when a selectable node is selected.\n  handleSelect() {\n    if (this._selectHandler) {\n      this._selectHandler();\n    }\n  }\n\n  // Called when a selectable element is pointed at.\n  onHoverStart() {\n\n  }\n\n  // Called when a selectable element is no longer pointed at.\n  onHoverEnd() {\n\n  }\n\n  _update(timestamp, frameDelta) {\n    this.onUpdate(timestamp, frameDelta);\n\n    for (let child of this.children) {\n      child._update(timestamp, frameDelta);\n    }\n  }\n\n  // Called every frame so that the nodes can animate themselves\n  onUpdate(timestamp, frameDelta) {\n\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/node.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nlet normalMat = mat3.create();\n\nconst RAY_INTERSECTION_OFFSET = 0.02;\n\nexport class Ray {\n  constructor(matrix = null) {\n    this.origin = vec3.create();\n\n    this._dir = vec3.create();\n    this._dir[2] = -1.0;\n\n    if (matrix) {\n      vec3.transformMat4(this.origin, this.origin, matrix);\n      mat3.fromMat4(normalMat, matrix);\n      vec3.transformMat3(this._dir, this._dir, normalMat);\n    }\n\n    // To force the inverse and sign calculations.\n    this.dir = this._dir;\n  }\n\n  get dir() {\n    return this._dir;\n  }\n\n  set dir(value) {\n    this._dir = vec3.copy(this._dir, value);\n    vec3.normalize(this._dir, this._dir);\n\n    this.inv_dir = vec3.fromValues(\n      1.0 / this._dir[0],\n      1.0 / this._dir[1],\n      1.0 / this._dir[2]);\n\n    this.sign = [\n      (this.inv_dir[0] < 0) ? 1 : 0,\n      (this.inv_dir[1] < 0) ? 1 : 0,\n      (this.inv_dir[2] < 0) ? 1 : 0,\n    ];\n  }\n\n  // Borrowed from:\n  // eslint-disable-next-line max-len\n  // https://www.scratchapixel.com/lessons/3d-basic-rendering/minimal-ray-tracer-rendering-simple-shapes/ray-box-intersection\n  intersectsAABB(min, max) {\n    let r = this;\n\n    let bounds = [min, max];\n\n    let tmin = (bounds[r.sign[0]][0] - r.origin[0]) * r.inv_dir[0];\n    let tmax = (bounds[1-r.sign[0]][0] - r.origin[0]) * r.inv_dir[0];\n    let tymin = (bounds[r.sign[1]][1] - r.origin[1]) * r.inv_dir[1];\n    let tymax = (bounds[1-r.sign[1]][1] - r.origin[1]) * r.inv_dir[1];\n\n    if ((tmin > tymax) || (tymin > tmax)) {\n      return null;\n    }\n    if (tymin > tmin) {\n      tmin = tymin;\n    }\n    if (tymax < tmax) {\n      tmax = tymax;\n    }\n\n    let tzmin = (bounds[r.sign[2]][2] - r.origin[2]) * r.inv_dir[2];\n    let tzmax = (bounds[1-r.sign[2]][2] - r.origin[2]) * r.inv_dir[2];\n\n    if ((tmin > tzmax) || (tzmin > tmax)) {\n      return null;\n    }\n    if (tzmin > tmin) {\n      tmin = tzmin;\n    }\n    if (tzmax < tmax) {\n      tmax = tzmax;\n    }\n\n    let t = -1;\n    if (tmin > 0 && tmax > 0) {\n      t = Math.min(tmin, tmax);\n    } else if (tmin > 0) {\n      t = tmin;\n    } else if (tmax > 0) {\n      t = tmax;\n    } else {\n      // Intersection is behind the ray origin.\n      return null;\n    }\n\n    // Push ray intersection point back along the ray a bit so that cursors\n    // don't accidentally intersect with the hit surface.\n    t -= RAY_INTERSECTION_OFFSET;\n\n    // Return the point where the ray first intersected with the AABB.\n    let intersectionPoint = vec3.clone(this._dir);\n    vec3.scale(intersectionPoint, intersectionPoint, t);\n    vec3.add(intersectionPoint, intersectionPoint, this.origin);\n    return intersectionPoint;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/ray.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {CAP, MAT_STATE, RENDER_ORDER, stateToBlendFunc} from './material.js';\nimport {Node} from './node.js';\nimport {Program} from './program.js';\nimport {DataTexture, VideoTexture} from './texture.js';\n\nexport const ATTRIB = {\n  POSITION: 1,\n  NORMAL: 2,\n  TANGENT: 3,\n  TEXCOORD_0: 4,\n  TEXCOORD_1: 5,\n  COLOR_0: 6,\n};\n\nexport const ATTRIB_MASK = {\n  POSITION: 0x0001,\n  NORMAL: 0x0002,\n  TANGENT: 0x0004,\n  TEXCOORD_0: 0x0008,\n  TEXCOORD_1: 0x0010,\n  COLOR_0: 0x0020,\n};\n\nconst GL = WebGLRenderingContext; // For enums\n\nconst DEF_LIGHT_DIR = new Float32Array([-0.1, -1.0, -0.2]);\nconst DEF_LIGHT_COLOR = new Float32Array([1.0, 1.0, 0.9]);\n\nconst PRECISION_REGEX = new RegExp('precision (lowp|mediump|highp) float;');\n\nconst VERTEX_SHADER_SINGLE_ENTRY = `\nuniform mat4 PROJECTION_MATRIX, VIEW_MATRIX, MODEL_MATRIX;\n\nvoid main() {\n  gl_Position = vertex_main(PROJECTION_MATRIX, VIEW_MATRIX, MODEL_MATRIX);\n}\n`;\n\nconst VERTEX_SHADER_MULTI_ENTRY = `\n#ERROR Multiview rendering is not implemented\nvoid main() {\n  gl_Position = vec4(0.0, 0.0, 0.0, 1.0);\n}\n`;\n\nconst FRAGMENT_SHADER_ENTRY = `\nvoid main() {\n  gl_FragColor = fragment_main();\n}\n`;\n\nfunction isPowerOfTwo(n) {\n  return (n & (n - 1)) === 0;\n}\n\n// Creates a WebGL context and initializes it with some common default state.\nexport function createWebGLContext(glAttribs) {\n  glAttribs = glAttribs || {alpha: false};\n\n  let webglCanvas = document.createElement('canvas');\n  let contextTypes = glAttribs.webgl2 ? ['webgl2'] : ['webgl', 'experimental-webgl'];\n  let context = null;\n\n  for (let contextType of contextTypes) {\n    context = webglCanvas.getContext(contextType, glAttribs);\n    if (context) {\n      break;\n    }\n  }\n\n  if (!context) {\n    let webglType = (glAttribs.webgl2 ? 'WebGL 2' : 'WebGL');\n    console.error('This browser does not support ' + webglType + '.');\n    return null;\n  }\n\n  return context;\n}\n\nexport class RenderView {\n  constructor(projectionMatrix, viewMatrix, viewport = null, eye = 'left') {\n    this.projectionMatrix = projectionMatrix;\n    this.viewMatrix = viewMatrix;\n    this.viewport = viewport;\n    // If an eye isn't given the left eye is assumed.\n    this._eye = eye;\n    this._eyeIndex = (eye == 'left' ? 0 : 1);\n  }\n\n  get eye() {\n    return this._eye;\n  }\n\n  set eye(value) {\n    this._eye = value;\n    this._eyeIndex = (value == 'left' ? 0 : 1);\n  }\n\n  get eyeIndex() {\n    return this._eyeIndex;\n  }\n}\n\nclass RenderBuffer {\n  constructor(target, usage, buffer, length = 0) {\n    this._target = target;\n    this._usage = usage;\n    this._length = length;\n    if (buffer instanceof Promise) {\n      this._buffer = null;\n      this._promise = buffer.then((buffer) => {\n        this._buffer = buffer;\n        return this;\n      });\n    } else {\n      this._buffer = buffer;\n      this._promise = Promise.resolve(this);\n    }\n  }\n\n  waitForComplete() {\n    return this._promise;\n  }\n}\n\nclass RenderPrimitiveAttribute {\n  constructor(primitiveAttribute) {\n    this._attrib_index = ATTRIB[primitiveAttribute.name];\n    this._componentCount = primitiveAttribute.componentCount;\n    this._componentType = primitiveAttribute.componentType;\n    this._stride = primitiveAttribute.stride;\n    this._byteOffset = primitiveAttribute.byteOffset;\n    this._normalized = primitiveAttribute.normalized;\n  }\n}\n\nclass RenderPrimitiveAttributeBuffer {\n  constructor(buffer) {\n    this._buffer = buffer;\n    this._attributes = [];\n  }\n}\n\nclass RenderPrimitive {\n  constructor(primitive) {\n    this._instances = [];\n    this._material = null;\n\n    this.setPrimitive(primitive);\n  }\n\n  setPrimitive(primitive) {\n    this._mode = primitive.mode;\n    this._elementCount = primitive.elementCount;\n    this._promise = null;\n    this._vao = null;\n    this._complete = false;\n    this._attributeBuffers = [];\n    this._attributeMask = 0;\n\n    for (let attribute of primitive.attributes) {\n      this._attributeMask |= ATTRIB_MASK[attribute.name];\n      let renderAttribute = new RenderPrimitiveAttribute(attribute);\n      let foundBuffer = false;\n      for (let attributeBuffer of this._attributeBuffers) {\n        if (attributeBuffer._buffer == attribute.buffer) {\n          attributeBuffer._attributes.push(renderAttribute);\n          foundBuffer = true;\n          break;\n        }\n      }\n      if (!foundBuffer) {\n        let attributeBuffer = new RenderPrimitiveAttributeBuffer(attribute.buffer);\n        attributeBuffer._attributes.push(renderAttribute);\n        this._attributeBuffers.push(attributeBuffer);\n      }\n    }\n\n    this._indexBuffer = null;\n    this._indexByteOffset = 0;\n    this._indexType = 0;\n\n    if (primitive.indexBuffer) {\n      this._indexByteOffset = primitive.indexByteOffset;\n      this._indexType = primitive.indexType;\n      this._indexBuffer = primitive.indexBuffer;\n    }\n\n    if (primitive._min) {\n      this._min = vec3.clone(primitive._min);\n      this._max = vec3.clone(primitive._max);\n    } else {\n      this._min = null;\n      this._max = null;\n    }\n\n    if (this._material != null) {\n      this.waitForComplete(); // To flip the _complete flag.\n    }\n  }\n\n  setRenderMaterial(material) {\n    this._material = material;\n    this._promise = null;\n    this._complete = false;\n\n    if (this._material != null) {\n      this.waitForComplete(); // To flip the _complete flag.\n    }\n  }\n\n  markActive(frameId) {\n    if (this._complete) {\n      this._activeFrameId = frameId;\n\n      if (this.material) {\n        this.material.markActive(frameId);\n      }\n\n      if (this.program) {\n        this.program.markActive(frameId);\n      }\n    }\n  }\n\n  get samplers() {\n    return this._material._samplerDictionary;\n  }\n\n  get uniforms() {\n    return this._material._uniform_dictionary;\n  }\n\n  waitForComplete() {\n    if (!this._promise) {\n      if (!this._material) {\n        return Promise.reject('RenderPrimitive does not have a material');\n      }\n\n      let completionPromises = [];\n      completionPromises.push(this._material.waitForComplete());\n\n      for (let attributeBuffer of this._attributeBuffers) {\n        if (!attributeBuffer._buffer._buffer) {\n          completionPromises.push(attributeBuffer._buffer._promise);\n        }\n      }\n\n      if (this._indexBuffer && !this._indexBuffer._buffer) {\n        completionPromises.push(this._indexBuffer._promise);\n      }\n\n      this._promise = Promise.all(completionPromises).then(() => {\n        this._complete = true;\n        return this;\n      });\n    }\n    return this._promise;\n  }\n}\n\nconst inverseMatrix = mat4.create();\n\nfunction setCap(gl, glEnum, cap, prevState, state) {\n  let change = (state & cap) - (prevState & cap);\n  if (!change) {\n    return;\n  }\n\n  if (change > 0) {\n    gl.enable(glEnum);\n  } else {\n    gl.disable(glEnum);\n  }\n}\n\nclass RenderMaterialSampler {\n  constructor(renderer, materialSampler, index) {\n    this._renderer = renderer;\n    this._uniformName = materialSampler._uniformName;\n    this._texture = renderer._getRenderTexture(materialSampler._texture);\n    this._index = index;\n  }\n\n  set texture(value) {\n    this._texture = this._renderer._getRenderTexture(value);\n  }\n}\n\nclass RenderMaterialUniform {\n  constructor(materialUniform) {\n    this._uniformName = materialUniform._uniformName;\n    this._uniform = null;\n    this._length = materialUniform._length;\n    if (materialUniform._value instanceof Array) {\n      this._value = new Float32Array(materialUniform._value);\n    } else {\n      this._value = new Float32Array([materialUniform._value]);\n    }\n  }\n\n  set value(value) {\n    if (this._value.length == 1) {\n      this._value[0] = value;\n    } else {\n      for (let i = 0; i < this._value.length; ++i) {\n        this._value[i] = value[i];\n      }\n    }\n  }\n}\n\nclass RenderMaterial {\n  constructor(renderer, material, program) {\n    this._program = program;\n    this._state = material.state._state;\n\n    this._samplerDictionary = {};\n    this._samplers = [];\n    for (let i = 0; i < material._samplers.length; ++i) {\n      let renderSampler = new RenderMaterialSampler(renderer, material._samplers[i], i);\n      this._samplers.push(renderSampler);\n      this._samplerDictionary[renderSampler._uniformName] = renderSampler;\n    }\n\n    this._uniform_dictionary = {};\n    this._uniforms = [];\n    for (let uniform of material._uniforms) {\n      let renderUniform = new RenderMaterialUniform(uniform);\n      this._uniforms.push(renderUniform);\n      this._uniform_dictionary[renderUniform._uniformName] = renderUniform;\n    }\n\n    this._completePromise = null;\n    this._firstBind = true;\n\n    this._renderOrder = material.renderOrder;\n    if (this._renderOrder == RENDER_ORDER.DEFAULT) {\n      if (this._state & CAP.BLEND) {\n        this._renderOrder = RENDER_ORDER.TRANSPARENT;\n      } else {\n        this._renderOrder = RENDER_ORDER.OPAQUE;\n      }\n    }\n  }\n\n  bind(gl) {\n    // First time we do a binding, cache the uniform locations and remove\n    // unused uniforms from the list.\n    if (this._firstBind) {\n      for (let i = 0; i < this._samplers.length;) {\n        let sampler = this._samplers[i];\n        if (!this._program.uniform[sampler._uniformName]) {\n          this._samplers.splice(i, 1);\n          continue;\n        }\n        ++i;\n      }\n\n      for (let i = 0; i < this._uniforms.length;) {\n        let uniform = this._uniforms[i];\n        uniform._uniform = this._program.uniform[uniform._uniformName];\n        if (!uniform._uniform) {\n          this._uniforms.splice(i, 1);\n          continue;\n        }\n        ++i;\n      }\n      this._firstBind = false;\n    }\n\n    for (let sampler of this._samplers) {\n      gl.activeTexture(gl.TEXTURE0 + sampler._index);\n      if (sampler._texture) {\n        gl.bindTexture(gl.TEXTURE_2D, sampler._texture);\n      } else {\n        gl.bindTexture(gl.TEXTURE_2D, null);\n      }\n    }\n\n    for (let uniform of this._uniforms) {\n      switch (uniform._length) {\n        case 1: gl.uniform1fv(uniform._uniform, uniform._value); break;\n        case 2: gl.uniform2fv(uniform._uniform, uniform._value); break;\n        case 3: gl.uniform3fv(uniform._uniform, uniform._value); break;\n        case 4: gl.uniform4fv(uniform._uniform, uniform._value); break;\n      }\n    }\n  }\n\n  waitForComplete() {\n    if (!this._completePromise) {\n      if (this._samplers.length == 0) {\n        this._completePromise = Promise.resolve(this);\n      } else {\n        let promises = [];\n        for (let sampler of this._samplers) {\n          if (sampler._texture && !sampler._texture._complete) {\n            promises.push(sampler._texture._promise);\n          }\n        }\n        this._completePromise = Promise.all(promises).then(() => this);\n      }\n    }\n    return this._completePromise;\n  }\n\n  // Material State fetchers\n  get cullFace() {\n    return !!(this._state & CAP.CULL_FACE);\n  }\n  get blend() {\n    return !!(this._state & CAP.BLEND);\n  }\n  get depthTest() {\n    return !!(this._state & CAP.DEPTH_TEST);\n  }\n  get stencilTest() {\n    return !!(this._state & CAP.STENCIL_TEST);\n  }\n  get colorMask() {\n    return !!(this._state & CAP.COLOR_MASK);\n  }\n  get depthMask() {\n    return !!(this._state & CAP.DEPTH_MASK);\n  }\n  get stencilMask() {\n    return !!(this._state & CAP.STENCIL_MASK);\n  }\n  get depthFunc() {\n    return ((this._state & MAT_STATE.DEPTH_FUNC_RANGE) >> MAT_STATE.DEPTH_FUNC_SHIFT) + GL.NEVER;\n  }\n  get blendFuncSrc() {\n    return stateToBlendFunc(this._state, MAT_STATE.BLEND_SRC_RANGE, MAT_STATE.BLEND_SRC_SHIFT);\n  }\n  get blendFuncDst() {\n    return stateToBlendFunc(this._state, MAT_STATE.BLEND_DST_RANGE, MAT_STATE.BLEND_DST_SHIFT);\n  }\n\n  // Only really for use from the renderer\n  _capsDiff(otherState) {\n    return (otherState & MAT_STATE.CAPS_RANGE) ^ (this._state & MAT_STATE.CAPS_RANGE);\n  }\n\n  _blendDiff(otherState) {\n    if (!(this._state & CAP.BLEND)) {\n      return 0;\n    }\n    return (otherState & MAT_STATE.BLEND_FUNC_RANGE) ^ (this._state & MAT_STATE.BLEND_FUNC_RANGE);\n  }\n\n  _depthFuncDiff(otherState) {\n    if (!(this._state & CAP.DEPTH_TEST)) {\n      return 0;\n    }\n    return (otherState & MAT_STATE.DEPTH_FUNC_RANGE) ^ (this._state & MAT_STATE.DEPTH_FUNC_RANGE);\n  }\n}\n\nexport class Renderer {\n  constructor(gl) {\n    this._gl = gl || createWebGLContext();\n    this._frameId = -1;\n    this._programCache = {};\n    this._textureCache = {};\n    this._renderPrimitives = Array(RENDER_ORDER.DEFAULT);\n    this._cameraPositions = [];\n\n    this._vaoExt = gl.getExtension('OES_vertex_array_object');\n\n    let fragHighPrecision = gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER, gl.HIGH_FLOAT);\n    this._defaultFragPrecision = fragHighPrecision.precision > 0 ? 'highp' : 'mediump';\n\n    this._depthMaskNeedsReset = false;\n    this._colorMaskNeedsReset = false;\n  }\n\n  get gl() {\n    return this._gl;\n  }\n\n  createRenderBuffer(target, data, usage = GL.STATIC_DRAW) {\n    let gl = this._gl;\n    let glBuffer = gl.createBuffer();\n\n    if (data instanceof Promise) {\n      let renderBuffer = new RenderBuffer(target, usage, data.then((data) => {\n        gl.bindBuffer(target, glBuffer);\n        gl.bufferData(target, data, usage);\n        renderBuffer._length = data.byteLength;\n        return glBuffer;\n      }));\n      return renderBuffer;\n    } else {\n      gl.bindBuffer(target, glBuffer);\n      gl.bufferData(target, data, usage);\n      return new RenderBuffer(target, usage, glBuffer, data.byteLength);\n    }\n  }\n\n  updateRenderBuffer(buffer, data, offset = 0) {\n    if (buffer._buffer) {\n      let gl = this._gl;\n      gl.bindBuffer(buffer._target, buffer._buffer);\n      if (offset == 0 && buffer._length == data.byteLength) {\n        gl.bufferData(buffer._target, data, buffer._usage);\n      } else {\n        gl.bufferSubData(buffer._target, offset, data);\n      }\n    } else {\n      buffer.waitForComplete().then((buffer) => {\n        this.updateRenderBuffer(buffer, data, offset);\n      });\n    }\n  }\n\n  createRenderPrimitive(primitive, material) {\n    let renderPrimitive = new RenderPrimitive(primitive);\n\n    let program = this._getMaterialProgram(material, renderPrimitive);\n    let renderMaterial = new RenderMaterial(this, material, program);\n    renderPrimitive.setRenderMaterial(renderMaterial);\n\n    if (!this._renderPrimitives[renderMaterial._renderOrder]) {\n      this._renderPrimitives[renderMaterial._renderOrder] = [];\n    }\n\n    this._renderPrimitives[renderMaterial._renderOrder].push(renderPrimitive);\n\n    return renderPrimitive;\n  }\n\n  createMesh(primitive, material) {\n    let meshNode = new Node();\n    meshNode.addRenderPrimitive(this.createRenderPrimitive(primitive, material));\n    return meshNode;\n  }\n\n  drawViews(views, rootNode) {\n    if (!rootNode) {\n      return;\n    }\n\n    let gl = this._gl;\n    this._frameId++;\n\n    rootNode.markActive(this._frameId);\n\n    // If there's only one view then flip the algorithm a bit so that we're only\n    // setting the viewport once.\n    if (views.length == 1 && views[0].viewport) {\n      let vp = views[0].viewport;\n      this._gl.viewport(vp.x, vp.y, vp.width, vp.height);\n    }\n\n    // Get the positions of the 'camera' for each view matrix.\n    for (let i = 0; i < views.length; ++i) {\n      mat4.invert(inverseMatrix, views[i].viewMatrix);\n\n      if (this._cameraPositions.length <= i) {\n        this._cameraPositions.push(vec3.create());\n      }\n      let cameraPosition = this._cameraPositions[i];\n      vec3.set(cameraPosition, 0, 0, 0);\n      vec3.transformMat4(cameraPosition, cameraPosition, inverseMatrix);\n    }\n\n    // Draw each set of render primitives in order\n    for (let renderPrimitives of this._renderPrimitives) {\n      if (renderPrimitives && renderPrimitives.length) {\n        this._drawRenderPrimitiveSet(views, renderPrimitives);\n      }\n    }\n\n    if (this._vaoExt) {\n      this._vaoExt.bindVertexArrayOES(null);\n    }\n\n    if (this._depthMaskNeedsReset) {\n      gl.depthMask(true);\n    }\n    if (this._colorMaskNeedsReset) {\n      gl.colorMask(true, true, true, true);\n    }\n  }\n\n  _drawRenderPrimitiveSet(views, renderPrimitives) {\n    let gl = this._gl;\n    let program = null;\n    let material = null;\n    let attribMask = 0;\n\n    // Loop through every primitive known to the renderer.\n    for (let primitive of renderPrimitives) {\n      // Skip over those that haven't been marked as active for this frame.\n      if (primitive._activeFrameId != this._frameId) {\n        continue;\n      }\n\n      // Bind the primitive material's program if it's different than the one we\n      // were using for the previous primitive.\n      // TODO: The ording of this could be more efficient.\n      if (program != primitive._material._program) {\n        program = primitive._material._program;\n        program.use();\n\n        if (program.uniform.LIGHT_DIRECTION) {\n          gl.uniform3fv(program.uniform.LIGHT_DIRECTION, DEF_LIGHT_DIR);\n        }\n\n        if (program.uniform.LIGHT_COLOR) {\n          gl.uniform3fv(program.uniform.LIGHT_COLOR, DEF_LIGHT_COLOR);\n        }\n\n        if (views.length == 1) {\n          gl.uniformMatrix4fv(program.uniform.PROJECTION_MATRIX, false, views[0].projectionMatrix);\n          gl.uniformMatrix4fv(program.uniform.VIEW_MATRIX, false, views[0].viewMatrix);\n          gl.uniform3fv(program.uniform.CAMERA_POSITION, this._cameraPositions[0]);\n          gl.uniform1i(program.uniform.EYE_INDEX, views[0].eyeIndex);\n        }\n      }\n\n      if (material != primitive._material) {\n        this._bindMaterialState(primitive._material, material);\n        primitive._material.bind(gl, program, material);\n        material = primitive._material;\n      }\n\n      if (this._vaoExt) {\n        if (primitive._vao) {\n          this._vaoExt.bindVertexArrayOES(primitive._vao);\n        } else {\n          primitive._vao = this._vaoExt.createVertexArrayOES();\n          this._vaoExt.bindVertexArrayOES(primitive._vao);\n          this._bindPrimitive(primitive);\n        }\n      } else {\n        this._bindPrimitive(primitive, attribMask);\n        attribMask = primitive._attributeMask;\n      }\n\n      for (let i = 0; i < views.length; ++i) {\n        let view = views[i];\n        if (views.length > 1) {\n          if (view.viewport) {\n            let vp = view.viewport;\n            gl.viewport(vp.x, vp.y, vp.width, vp.height);\n          }\n          gl.uniformMatrix4fv(program.uniform.PROJECTION_MATRIX, false, view.projectionMatrix);\n          gl.uniformMatrix4fv(program.uniform.VIEW_MATRIX, false, view.viewMatrix);\n          gl.uniform3fv(program.uniform.CAMERA_POSITION, this._cameraPositions[i]);\n          gl.uniform1i(program.uniform.EYE_INDEX, view.eyeIndex);\n        }\n\n        for (let instance of primitive._instances) {\n          if (instance._activeFrameId != this._frameId) {\n            continue;\n          }\n\n          gl.uniformMatrix4fv(program.uniform.MODEL_MATRIX, false, instance.worldMatrix);\n\n          if (primitive._indexBuffer) {\n            gl.drawElements(primitive._mode, primitive._elementCount,\n                primitive._indexType, primitive._indexByteOffset);\n          } else {\n            gl.drawArrays(primitive._mode, 0, primitive._elementCount);\n          }\n        }\n      }\n    }\n  }\n\n  _getRenderTexture(texture) {\n    if (!texture) {\n      return null;\n    }\n\n    let key = texture.textureKey;\n    if (!key) {\n      throw new Error('Texure does not have a valid key');\n    }\n\n    let gl = this._gl;\n    let textureHandle = null;\n\n    function updateVideoFrame() {\n      if (!texture._video.paused && !texture._video.waiting) {\n        gl.bindTexture(gl.TEXTURE_2D, textureHandle);\n        gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.format, gl.UNSIGNED_BYTE, texture.source);\n        window.setTimeout(updateVideoFrame, 16); // TODO: UUUUUUUGGGGGGGHHHH!\n      }\n    }\n\n    if (key in this._textureCache) {\n      return this._textureCache[key];\n    } else {\n      textureHandle = gl.createTexture();\n      this._textureCache[key] = textureHandle;\n\n      if (texture instanceof DataTexture) {\n        gl.bindTexture(gl.TEXTURE_2D, textureHandle);\n        gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.width, texture.height,\n                                     0, texture.format, texture._type, texture._data);\n        this._setSamplerParameters(texture);\n      } else {\n        // Initialize the texture to black\n        gl.bindTexture(gl.TEXTURE_2D, textureHandle);\n        gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.width, texture.height,\n                                     0, texture.format, gl.UNSIGNED_BYTE, null);\n        this._setSamplerParameters(texture);\n\n        texture.waitForComplete().then(() => {\n          gl.bindTexture(gl.TEXTURE_2D, textureHandle);\n          gl.texImage2D(gl.TEXTURE_2D, 0, texture.format, texture.format, gl.UNSIGNED_BYTE, texture.source);\n          this._setSamplerParameters(texture);\n\n          if (texture instanceof VideoTexture) {\n            // \"Listen for updates\" to the video frames and copy to the texture.\n            texture._video.addEventListener('playing', updateVideoFrame);\n          }\n        });\n      }\n\n      return textureHandle;\n    }\n  }\n\n  _setSamplerParameters(texture) {\n    let gl = this._gl;\n\n    let sampler = texture.sampler;\n    let powerOfTwo = isPowerOfTwo(texture.width) && isPowerOfTwo(texture.height);\n    let mipmap = powerOfTwo && texture.mipmap;\n    if (mipmap) {\n      gl.generateMipmap(gl.TEXTURE_2D);\n    }\n\n    let minFilter = sampler.minFilter || (mipmap ? gl.LINEAR_MIPMAP_LINEAR : gl.LINEAR);\n    let wrapS = sampler.wrapS || (powerOfTwo ? gl.REPEAT : gl.CLAMP_TO_EDGE);\n    let wrapT = sampler.wrapT || (powerOfTwo ? gl.REPEAT : gl.CLAMP_TO_EDGE);\n\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, sampler.magFilter || gl.LINEAR);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, minFilter);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrapS);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrapT);\n  }\n\n  _getProgramKey(name, defines) {\n    let key = `${name}:`;\n\n    for (let define in defines) {\n      key += `${define}=${defines[define]},`;\n    }\n\n    return key;\n  }\n\n  _getMaterialProgram(material, renderPrimitive) {\n    let materialName = material.materialName;\n    let vertexSource = material.vertexSource;\n    let fragmentSource = material.fragmentSource;\n\n    // These should always be defined for every material\n    if (materialName == null) {\n      throw new Error('Material does not have a name');\n    }\n    if (vertexSource == null) {\n      throw new Error(`Material \"${materialName}\" does not have a vertex source`);\n    }\n    if (fragmentSource == null) {\n      throw new Error(`Material \"${materialName}\" does not have a fragment source`);\n    }\n\n    let defines = material.getProgramDefines(renderPrimitive);\n    let key = this._getProgramKey(materialName, defines);\n\n    if (key in this._programCache) {\n      return this._programCache[key];\n    } else {\n      let multiview = false; // Handle this dynamically later\n      let fullVertexSource = vertexSource;\n      fullVertexSource += multiview ? VERTEX_SHADER_MULTI_ENTRY :\n                                      VERTEX_SHADER_SINGLE_ENTRY;\n\n      let precisionMatch = fragmentSource.match(PRECISION_REGEX);\n      let fragPrecisionHeader = precisionMatch ? '' : `precision ${this._defaultFragPrecision} float;\\n`;\n\n      let fullFragmentSource = fragPrecisionHeader + fragmentSource;\n      fullFragmentSource += FRAGMENT_SHADER_ENTRY;\n\n      let program = new Program(this._gl, fullVertexSource, fullFragmentSource, ATTRIB, defines);\n      this._programCache[key] = program;\n\n      program.onNextUse((program) => {\n        // Bind the samplers to the right texture index. This is constant for\n        // the lifetime of the program.\n        for (let i = 0; i < material._samplers.length; ++i) {\n          let sampler = material._samplers[i];\n          let uniform = program.uniform[sampler._uniformName];\n          if (uniform) {\n            this._gl.uniform1i(uniform, i);\n          }\n        }\n      });\n\n      return program;\n    }\n  }\n\n  _bindPrimitive(primitive, attribMask) {\n    let gl = this._gl;\n\n    // If the active attributes have changed then update the active set.\n    if (attribMask != primitive._attributeMask) {\n      for (let attrib in ATTRIB) {\n        if (primitive._attributeMask & ATTRIB_MASK[attrib]) {\n          gl.enableVertexAttribArray(ATTRIB[attrib]);\n        } else {\n          gl.disableVertexAttribArray(ATTRIB[attrib]);\n        }\n      }\n    }\n\n    // Bind the primitive attributes and indices.\n    for (let attributeBuffer of primitive._attributeBuffers) {\n      gl.bindBuffer(gl.ARRAY_BUFFER, attributeBuffer._buffer._buffer);\n      for (let attrib of attributeBuffer._attributes) {\n        gl.vertexAttribPointer(\n            attrib._attrib_index, attrib._componentCount, attrib._componentType,\n            attrib._normalized, attrib._stride, attrib._byteOffset);\n      }\n    }\n\n    if (primitive._indexBuffer) {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, primitive._indexBuffer._buffer);\n    } else {\n      gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n    }\n  }\n\n  _bindMaterialState(material, prevMaterial = null) {\n    let gl = this._gl;\n\n    let state = material._state;\n    let prevState = prevMaterial ? prevMaterial._state : ~state;\n\n    // Return early if both materials use identical state\n    if (state == prevState) {\n      return;\n    }\n\n    // Any caps bits changed?\n    if (material._capsDiff(prevState)) {\n      setCap(gl, gl.CULL_FACE, CAP.CULL_FACE, prevState, state);\n      setCap(gl, gl.BLEND, CAP.BLEND, prevState, state);\n      setCap(gl, gl.DEPTH_TEST, CAP.DEPTH_TEST, prevState, state);\n      setCap(gl, gl.STENCIL_TEST, CAP.STENCIL_TEST, prevState, state);\n\n      let colorMaskChange = (state & CAP.COLOR_MASK) - (prevState & CAP.COLOR_MASK);\n      if (colorMaskChange) {\n        let mask = colorMaskChange > 1;\n        this._colorMaskNeedsReset = !mask;\n        gl.colorMask(mask, mask, mask, mask);\n      }\n\n      let depthMaskChange = (state & CAP.DEPTH_MASK) - (prevState & CAP.DEPTH_MASK);\n      if (depthMaskChange) {\n        this._depthMaskNeedsReset = !(depthMaskChange > 1);\n        gl.depthMask(depthMaskChange > 1);\n      }\n\n      let stencilMaskChange = (state & CAP.STENCIL_MASK) - (prevState & CAP.STENCIL_MASK);\n      if (stencilMaskChange) {\n        gl.stencilMask(stencilMaskChange > 1);\n      }\n    }\n\n    // Blending enabled and blend func changed?\n    if (material._blendDiff(prevState)) {\n      gl.blendFunc(material.blendFuncSrc, material.blendFuncDst);\n    }\n\n    // Depth testing enabled and depth func changed?\n    if (material._depthFuncDiff(prevState)) {\n      gl.depthFunc(material.depthFunc);\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/renderer.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nconst GL = WebGLRenderingContext; // For enums\n\nexport const CAP = {\n  // Enable caps\n  CULL_FACE: 0x001,\n  BLEND: 0x002,\n  DEPTH_TEST: 0x004,\n  STENCIL_TEST: 0x008,\n  COLOR_MASK: 0x010,\n  DEPTH_MASK: 0x020,\n  STENCIL_MASK: 0x040,\n};\n\nexport const MAT_STATE = {\n  CAPS_RANGE: 0x000000FF,\n  BLEND_SRC_SHIFT: 8,\n  BLEND_SRC_RANGE: 0x00000F00,\n  BLEND_DST_SHIFT: 12,\n  BLEND_DST_RANGE: 0x0000F000,\n  BLEND_FUNC_RANGE: 0x0000FF00,\n  DEPTH_FUNC_SHIFT: 16,\n  DEPTH_FUNC_RANGE: 0x000F0000,\n};\n\nexport const RENDER_ORDER = {\n  // Render opaque objects first.\n  OPAQUE: 0,\n\n  // Render the sky after all opaque object to save fill rate.\n  SKY: 1,\n\n  // Render transparent objects next so that the opaqe objects show through.\n  TRANSPARENT: 2,\n\n  // Finally render purely additive effects like pointer rays so that they\n  // can render without depth mask.\n  ADDITIVE: 3,\n\n  // Render order will be picked based on the material properties.\n  DEFAULT: 4,\n};\n\nexport function stateToBlendFunc(state, mask, shift) {\n  let value = (state & mask) >> shift;\n  switch (value) {\n    case 0:\n    case 1:\n      return value;\n    default:\n      return (value - 2) + GL.SRC_COLOR;\n  }\n}\n\nexport class MaterialState {\n  constructor() {\n    this._state = CAP.CULL_FACE |\n                  CAP.DEPTH_TEST |\n                  CAP.COLOR_MASK |\n                  CAP.DEPTH_MASK;\n\n    // Use a fairly commonly desired blend func as the default.\n    this.blendFuncSrc = GL.SRC_ALPHA;\n    this.blendFuncDst = GL.ONE_MINUS_SRC_ALPHA;\n\n    this.depthFunc = GL.LESS;\n  }\n\n  get cullFace() {\n    return !!(this._state & CAP.CULL_FACE);\n  }\n  set cullFace(value) {\n    if (value) {\n      this._state |= CAP.CULL_FACE;\n    } else {\n      this._state &= ~CAP.CULL_FACE;\n    }\n  }\n\n  get blend() {\n    return !!(this._state & CAP.BLEND);\n  }\n  set blend(value) {\n    if (value) {\n      this._state |= CAP.BLEND;\n    } else {\n      this._state &= ~CAP.BLEND;\n    }\n  }\n\n  get depthTest() {\n    return !!(this._state & CAP.DEPTH_TEST);\n  }\n  set depthTest(value) {\n    if (value) {\n      this._state |= CAP.DEPTH_TEST;\n    } else {\n      this._state &= ~CAP.DEPTH_TEST;\n    }\n  }\n\n  get stencilTest() {\n    return !!(this._state & CAP.STENCIL_TEST);\n  }\n  set stencilTest(value) {\n    if (value) {\n      this._state |= CAP.STENCIL_TEST;\n    } else {\n      this._state &= ~CAP.STENCIL_TEST;\n    }\n  }\n\n  get colorMask() {\n    return !!(this._state & CAP.COLOR_MASK);\n  }\n  set colorMask(value) {\n    if (value) {\n      this._state |= CAP.COLOR_MASK;\n    } else {\n      this._state &= ~CAP.COLOR_MASK;\n    }\n  }\n\n  get depthMask() {\n    return !!(this._state & CAP.DEPTH_MASK);\n  }\n  set depthMask(value) {\n    if (value) {\n      this._state |= CAP.DEPTH_MASK;\n    } else {\n      this._state &= ~CAP.DEPTH_MASK;\n    }\n  }\n\n  get depthFunc() {\n    return ((this._state & MAT_STATE.DEPTH_FUNC_RANGE) >> MAT_STATE.DEPTH_FUNC_SHIFT) + GL.NEVER;\n  }\n  set depthFunc(value) {\n    value = value - GL.NEVER;\n    this._state &= ~MAT_STATE.DEPTH_FUNC_RANGE;\n    this._state |= (value << MAT_STATE.DEPTH_FUNC_SHIFT);\n  }\n\n  get stencilMask() {\n    return !!(this._state & CAP.STENCIL_MASK);\n  }\n  set stencilMask(value) {\n    if (value) {\n      this._state |= CAP.STENCIL_MASK;\n    } else {\n      this._state &= ~CAP.STENCIL_MASK;\n    }\n  }\n\n  get blendFuncSrc() {\n    return stateToBlendFunc(this._state, MAT_STATE.BLEND_SRC_RANGE, MAT_STATE.BLEND_SRC_SHIFT);\n  }\n  set blendFuncSrc(value) {\n    switch (value) {\n      case 0:\n      case 1:\n        break;\n      default:\n        value = (value - GL.SRC_COLOR) + 2;\n    }\n    this._state &= ~MAT_STATE.BLEND_SRC_RANGE;\n    this._state |= (value << MAT_STATE.BLEND_SRC_SHIFT);\n  }\n\n  get blendFuncDst() {\n    return stateToBlendFunc(this._state, MAT_STATE.BLEND_DST_RANGE, MAT_STATE.BLEND_DST_SHIFT);\n  }\n  set blendFuncDst(value) {\n    switch (value) {\n      case 0:\n      case 1:\n        break;\n      default:\n        value = (value - GL.SRC_COLOR) + 2;\n    }\n    this._state &= ~MAT_STATE.BLEND_DST_RANGE;\n    this._state |= (value << MAT_STATE.BLEND_DST_SHIFT);\n  }\n}\n\nclass MaterialSampler {\n  constructor(uniformName) {\n    this._uniformName = uniformName;\n    this._texture = null;\n  }\n\n  get texture() {\n    return this._texture;\n  }\n\n  set texture(value) {\n    this._texture = value;\n  }\n}\n\nclass MaterialUniform {\n  constructor(uniformName, defaultValue, length) {\n    this._uniformName = uniformName;\n    this._value = defaultValue;\n    this._length = length;\n    if (!this._length) {\n      if (defaultValue instanceof Array) {\n        this._length = defaultValue.length;\n      } else {\n        this._length = 1;\n      }\n    }\n  }\n\n  get value() {\n    return this._value;\n  }\n\n  set value(value) {\n    this._value = value;\n  }\n}\n\nexport class Material {\n  constructor() {\n    this.state = new MaterialState;\n    this.renderOrder = RENDER_ORDER.DEFAULT;\n    this._samplers = [];\n    this._uniforms = [];\n  }\n\n  defineSampler(uniformName) {\n    let sampler = new MaterialSampler(uniformName);\n    this._samplers.push(sampler);\n    return sampler;\n  }\n\n  defineUniform(uniformName, defaultValue=null, length=0) {\n    let uniform = new MaterialUniform(uniformName, defaultValue, length);\n    this._uniforms.push(uniform);\n    return uniform;\n  }\n\n  get materialName() {\n    return null;\n  }\n\n  get vertexSource() {\n    return null;\n  }\n\n  get fragmentSource() {\n    return null;\n  }\n\n  getProgramDefines(renderPrimitive) {\n    return {};\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/material.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nexport class Program {\n  constructor(gl, vertSrc, fragSrc, attribMap, defines) {\n    this._gl = gl;\n    this.program = gl.createProgram();\n    this.attrib = null;\n    this.uniform = null;\n    this.defines = {};\n\n    this._firstUse = true;\n    this._nextUseCallbacks = [];\n\n    let definesString = '';\n    if (defines) {\n      for (let define in defines) {\n        this.defines[define] = defines[define];\n        definesString += `#define ${define} ${defines[define]}\\n`;\n      }\n    }\n\n    this._vertShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.attachShader(this.program, this._vertShader);\n    gl.shaderSource(this._vertShader, definesString + vertSrc);\n    gl.compileShader(this._vertShader);\n\n    this._fragShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.attachShader(this.program, this._fragShader);\n    gl.shaderSource(this._fragShader, definesString + fragSrc);\n    gl.compileShader(this._fragShader);\n\n    if (attribMap) {\n      this.attrib = {};\n      for (let attribName in attribMap) {\n        gl.bindAttribLocation(this.program, attribMap[attribName], attribName);\n        this.attrib[attribName] = attribMap[attribName];\n      }\n    }\n\n    gl.linkProgram(this.program);\n  }\n\n  onNextUse(callback) {\n    this._nextUseCallbacks.push(callback);\n  }\n\n  use() {\n    let gl = this._gl;\n\n    // If this is the first time the program has been used do all the error checking and\n    // attrib/uniform querying needed.\n    if (this._firstUse) {\n      this._firstUse = false;\n      if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n        if (!gl.getShaderParameter(this._vertShader, gl.COMPILE_STATUS)) {\n          console.error('Vertex shader compile error: ' + gl.getShaderInfoLog(this._vertShader));\n        } else if (!gl.getShaderParameter(this._fragShader, gl.COMPILE_STATUS)) {\n          console.error('Fragment shader compile error: ' + gl.getShaderInfoLog(this._fragShader));\n        } else {\n          console.error('Program link error: ' + gl.getProgramInfoLog(this.program));\n        }\n        gl.deleteProgram(this.program);\n        this.program = null;\n      } else {\n        if (!this.attrib) {\n          this.attrib = {};\n          let attribCount = gl.getProgramParameter(this.program, gl.ACTIVE_ATTRIBUTES);\n          for (let i = 0; i < attribCount; i++) {\n            let attribInfo = gl.getActiveAttrib(this.program, i);\n            this.attrib[attribInfo.name] = gl.getAttribLocation(this.program, attribInfo.name);\n          }\n        }\n\n        this.uniform = {};\n        let uniformCount = gl.getProgramParameter(this.program, gl.ACTIVE_UNIFORMS);\n        let uniformName = '';\n        for (let i = 0; i < uniformCount; i++) {\n          let uniformInfo = gl.getActiveUniform(this.program, i);\n          uniformName = uniformInfo.name.replace('[0]', '');\n          this.uniform[uniformName] = gl.getUniformLocation(this.program, uniformName);\n        }\n      }\n      gl.deleteShader(this._vertShader);\n      gl.deleteShader(this._fragShader);\n    }\n\n    gl.useProgram(this.program);\n\n    if (this._nextUseCallbacks.length) {\n      for (let callback of this._nextUseCallbacks) {\n        callback(this);\n      }\n      this._nextUseCallbacks = [];\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/program.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nconst GL = WebGLRenderingContext; // For enums\n\nexport class TextureSampler {\n  constructor() {\n    this.minFilter = null;\n    this.magFilter = null;\n    this.wrapS = null;\n    this.wrapT = null;\n  }\n}\n\nexport class Texture {\n  constructor() {\n    this.sampler = new TextureSampler();\n    this.mipmap = true;\n    // TODO: Anisotropy\n  }\n\n  get format() {\n    return GL.RGBA;\n  }\n\n  get width() {\n    return 0;\n  }\n\n  get height() {\n    return 0;\n  }\n\n  get textureKey() {\n    return null;\n  }\n}\n\nexport class ImageTexture extends Texture {\n  constructor(img) {\n    super();\n\n    this._img = img;\n\n    if (img.src && img.complete) {\n      if (img.naturalWidth) {\n        this._promise = Promise.resolve(this);\n      } else {\n        this._promise = Promise.reject('Image provided had failed to load.');\n      }\n    } else {\n      this._promise = new Promise((resolve, reject) => {\n        img.addEventListener('load', () => resolve(this));\n        img.addEventListener('error', reject);\n      });\n    }\n  }\n\n  get format() {\n    // TODO: Can be RGB in some cases.\n    return GL.RGBA;\n  }\n\n  get width() {\n    return this._img.width;\n  }\n\n  get height() {\n    return this._img.height;\n  }\n\n  waitForComplete() {\n    return this._promise;\n  }\n\n  get textureKey() {\n    return this._img.src;\n  }\n\n  get source() {\n    return this._img;\n  }\n}\n\nexport class UrlTexture extends ImageTexture {\n  constructor(url) {\n    let img = new Image();\n    super(img);\n    img.src = url;\n  }\n}\n\nexport class BlobTexture extends ImageTexture {\n  constructor(blob) {\n    let img = new Image();\n    super(img);\n    img.src = window.URL.createObjectURL(blob);\n  }\n}\n\nexport class VideoTexture extends Texture {\n  constructor(video) {\n    super();\n\n    this._video = video;\n\n    if (video.readyState >= 2) {\n      this._promise = Promise.resolve(this);\n    } else if (video.error) {\n      this._promise = Promise.reject(video.error);\n    } else {\n      this._promise = new Promise((resolve, reject) => {\n        video.addEventListener('loadeddata', () => resolve(this));\n        video.addEventListener('error', reject);\n      });\n    }\n  }\n\n  get format() {\n    // TODO: Can be RGB in some cases.\n    return GL.RGBA;\n  }\n\n  get width() {\n    return this._video.videoWidth;\n  }\n\n  get height() {\n    return this._video.videoHeight;\n  }\n\n  waitForComplete() {\n    return this._promise;\n  }\n\n  get textureKey() {\n    return this._video.src;\n  }\n\n  get source() {\n    return this._video;\n  }\n}\n\nlet nextDataTextureIndex = 0;\n\nexport class DataTexture extends Texture {\n  constructor(data, width, height, format = GL.RGBA, type = GL.UNSIGNED_BYTE) {\n    super();\n\n    this._data = data;\n    this._width = width;\n    this._height = height;\n    this._format = format;\n    this._type = type;\n    this._key = `DATA_${nextDataTextureIndex}`;\n    nextDataTextureIndex++;\n  }\n\n  get format() {\n    return this._format;\n  }\n\n  get width() {\n    return this._width;\n  }\n\n  get height() {\n    return this._height;\n  }\n\n  get textureKey() {\n    return this._key;\n  }\n}\n\nexport class ColorTexture extends DataTexture {\n  constructor(r, g, b, a) {\n    let colorData = new Uint8Array([r*255.0, g*255.0, b*255.0, a*255.0]);\n    super(colorData, 1, 1);\n\n    this.mipmap = false;\n    this._key = `COLOR_${colorData[0]}_${colorData[1]}_${colorData[2]}_${colorData[3]}`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/texture.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {Primitive, PrimitiveAttribute} from '../core/primitive.js';\n\nconst GL = WebGLRenderingContext; // For enums\n\nconst tempVec3 = vec3.create();\n\nexport class PrimitiveStream {\n  constructor(options) {\n    this._vertices = [];\n    this._indices = [];\n\n    this._geometryStarted = false;\n\n    this._vertexOffset = 0;\n    this._vertexIndex = 0;\n    this._highIndex = 0;\n\n    this._flipWinding = false;\n    this._invertNormals = false;\n    this._transform = null;\n    this._normalTransform = null;\n    this._min = null;\n    this._max = null;\n  }\n\n  set flipWinding(value) {\n    if (this._geometryStarted) {\n      throw new Error(`Cannot change flipWinding before ending the current geometry.`);\n    }\n    this._flipWinding = value;\n  }\n\n  get flipWinding() {\n    this._flipWinding;\n  }\n\n  set invertNormals(value) {\n    if (this._geometryStarted) {\n      throw new Error(`Cannot change invertNormals before ending the current geometry.`);\n    }\n    this._invertNormals = value;\n  }\n\n  get invertNormals() {\n    this._invertNormals;\n  }\n\n  set transform(value) {\n    if (this._geometryStarted) {\n      throw new Error(`Cannot change transform before ending the current geometry.`);\n    }\n    this._transform = value;\n    if (this._transform) {\n      if (!this._normalTransform) {\n        this._normalTransform = mat3.create();\n      }\n      mat3.fromMat4(this._normalTransform, this._transform);\n    }\n  }\n\n  get transform() {\n    this._transform;\n  }\n\n  startGeometry() {\n    if (this._geometryStarted) {\n      throw new Error(`Attempted to start a new geometry before the previous one was ended.`);\n    }\n\n    this._geometryStarted = true;\n    this._vertexIndex = 0;\n    this._highIndex = 0;\n  }\n\n  endGeometry() {\n    if (!this._geometryStarted) {\n      throw new Error(`Attempted to end a geometry before one was started.`);\n    }\n\n    if (this._highIndex >= this._vertexIndex) {\n      throw new Error(`Geometry contains indices that are out of bounds.\n                       (Contains an index of ${this._highIndex} when the vertex count is ${this._vertexIndex})`);\n    }\n\n    this._geometryStarted = false;\n    this._vertexOffset += this._vertexIndex;\n\n    // TODO: Anything else need to be done to finish processing here?\n  }\n\n  pushVertex(x, y, z, u, v, nx, ny, nz) {\n    if (!this._geometryStarted) {\n      throw new Error(`Cannot push vertices before calling startGeometry().`);\n    }\n\n    // Transform the incoming vertex if we have a transformation matrix\n    if (this._transform) {\n      tempVec3[0] = x;\n      tempVec3[1] = y;\n      tempVec3[2] = z;\n      vec3.transformMat4(tempVec3, tempVec3, this._transform);\n      x = tempVec3[0];\n      y = tempVec3[1];\n      z = tempVec3[2];\n\n      tempVec3[0] = nx;\n      tempVec3[1] = ny;\n      tempVec3[2] = nz;\n      vec3.transformMat3(tempVec3, tempVec3, this._normalTransform);\n      nx = tempVec3[0];\n      ny = tempVec3[1];\n      nz = tempVec3[2];\n    }\n\n    if (this._invertNormals) {\n      nx *= -1.0;\n      ny *= -1.0;\n      nz *= -1.0;\n    }\n\n    this._vertices.push(x, y, z, u, v, nx, ny, nz);\n\n    if (this._min) {\n      this._min[0] = Math.min(this._min[0], x);\n      this._min[1] = Math.min(this._min[1], y);\n      this._min[2] = Math.min(this._min[2], z);\n      this._max[0] = Math.max(this._max[0], x);\n      this._max[1] = Math.max(this._max[1], y);\n      this._max[2] = Math.max(this._max[2], z);\n    } else {\n      this._min = vec3.fromValues(x, y, z);\n      this._max = vec3.fromValues(x, y, z);\n    }\n\n    return this._vertexIndex++;\n  }\n\n  get nextVertexIndex() {\n    return this._vertexIndex;\n  }\n\n  pushTriangle(idxA, idxB, idxC) {\n    if (!this._geometryStarted) {\n      throw new Error(`Cannot push triangles before calling startGeometry().`);\n    }\n\n    this._highIndex = Math.max(this._highIndex, idxA, idxB, idxC);\n\n    idxA += this._vertexOffset;\n    idxB += this._vertexOffset;\n    idxC += this._vertexOffset;\n\n    if (this._flipWinding) {\n      this._indices.push(idxC, idxB, idxA);\n    } else {\n      this._indices.push(idxA, idxB, idxC);\n    }\n  }\n\n  clear() {\n    if (this._geometryStarted) {\n      throw new Error(`Cannot clear before ending the current geometry.`);\n    }\n\n    this._vertices = [];\n    this._indices = [];\n    this._vertexOffset = 0;\n    this._min = null;\n    this._max = null;\n  }\n\n  finishPrimitive(renderer) {\n    if (!this._vertexOffset) {\n      throw new Error(`Attempted to call finishPrimitive() before creating any geometry.`);\n    }\n\n    let vertexBuffer = renderer.createRenderBuffer(GL.ARRAY_BUFFER, new Float32Array(this._vertices));\n    let indexBuffer = renderer.createRenderBuffer(GL.ELEMENT_ARRAY_BUFFER, new Uint16Array(this._indices));\n\n    let attribs = [\n      new PrimitiveAttribute('POSITION', vertexBuffer, 3, GL.FLOAT, 32, 0),\n      new PrimitiveAttribute('TEXCOORD_0', vertexBuffer, 2, GL.FLOAT, 32, 12),\n      new PrimitiveAttribute('NORMAL', vertexBuffer, 3, GL.FLOAT, 32, 20),\n    ];\n\n    let primitive = new Primitive(attribs, this._indices.length);\n    primitive.setIndexBuffer(indexBuffer);\n    primitive.setBounds(this._min, this._max);\n\n    return primitive;\n  }\n}\n\nexport class GeometryBuilderBase {\n  constructor(primitiveStream) {\n    if (primitiveStream) {\n      this._stream = primitiveStream;\n    } else {\n      this._stream = new PrimitiveStream();\n    }\n  }\n\n  set primitiveStream(value) {\n    this._stream = value;\n  }\n\n  get primitiveStream() {\n    return this._stream;\n  }\n\n  finishPrimitive(renderer) {\n    return this._stream.finishPrimitive(renderer);\n  }\n\n  clear() {\n    this._stream.clear();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/geometry/primitive-stream.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nexport class PrimitiveAttribute {\n  constructor(name, buffer, componentCount, componentType, stride, byteOffset) {\n    this.name = name;\n    this.buffer = buffer;\n    this.componentCount = componentCount || 3;\n    this.componentType = componentType || 5126; // gl.FLOAT;\n    this.stride = stride || 0;\n    this.byteOffset = byteOffset || 0;\n    this.normalized = false;\n  }\n}\n\nexport class Primitive {\n  constructor(attributes, elementCount, mode) {\n    this.attributes = attributes || [];\n    this.elementCount = elementCount || 0;\n    this.mode = mode || 4; // gl.TRIANGLES;\n    this.indexBuffer = null;\n    this.indexByteOffset = 0;\n    this.indexType = 0;\n    this._min = null;\n    this._max = null;\n  }\n\n  setIndexBuffer(indexBuffer, byteOffset, indexType) {\n    this.indexBuffer = indexBuffer;\n    this.indexByteOffset = byteOffset || 0;\n    this.indexType = indexType || 5123; // gl.UNSIGNED_SHORT;\n  }\n\n  setBounds(min, max) {\n    this._min = vec3.clone(min);\n    this._max = vec3.clone(max);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/primitive.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {GeometryBuilderBase} from './primitive-stream.js';\n\nexport class BoxBuilder extends GeometryBuilderBase {\n  pushBox(min, max) {\n    let stream = this.primitiveStream;\n\n    let w = max[0] - min[0];\n    let h = max[1] - min[1];\n    let d = max[2] - min[2];\n\n    let wh = w * 0.5;\n    let hh = h * 0.5;\n    let dh = d * 0.5;\n\n    let cx = min[0] + wh;\n    let cy = min[1] + hh;\n    let cz = min[2] + dh;\n\n    stream.startGeometry();\n\n    // Bottom\n    let idx = stream.nextVertexIndex;\n    stream.pushTriangle(idx, idx+1, idx+2);\n    stream.pushTriangle(idx, idx+2, idx+3);\n\n    //                 X       Y       Z      U    V    NX    NY   NZ\n    stream.pushVertex(-wh+cx, -hh+cy, -dh+cz, 0.0, 1.0, 0.0, -1.0, 0.0);\n    stream.pushVertex(+wh+cx, -hh+cy, -dh+cz, 1.0, 1.0, 0.0, -1.0, 0.0);\n    stream.pushVertex(+wh+cx, -hh+cy, +dh+cz, 1.0, 0.0, 0.0, -1.0, 0.0);\n    stream.pushVertex(-wh+cx, -hh+cy, +dh+cz, 0.0, 0.0, 0.0, -1.0, 0.0);\n\n    // Top\n    idx = stream.nextVertexIndex;\n    stream.pushTriangle(idx, idx+2, idx+1);\n    stream.pushTriangle(idx, idx+3, idx+2);\n\n    stream.pushVertex(-wh+cx, +hh+cy, -dh+cz, 0.0, 0.0, 0.0, 1.0, 0.0);\n    stream.pushVertex(+wh+cx, +hh+cy, -dh+cz, 1.0, 0.0, 0.0, 1.0, 0.0);\n    stream.pushVertex(+wh+cx, +hh+cy, +dh+cz, 1.0, 1.0, 0.0, 1.0, 0.0);\n    stream.pushVertex(-wh+cx, +hh+cy, +dh+cz, 0.0, 1.0, 0.0, 1.0, 0.0);\n\n    // Left\n    idx = stream.nextVertexIndex;\n    stream.pushTriangle(idx, idx+2, idx+1);\n    stream.pushTriangle(idx, idx+3, idx+2);\n\n    stream.pushVertex(-wh+cx, -hh+cy, -dh+cz, 0.0, 1.0, -1.0, 0.0, 0.0);\n    stream.pushVertex(-wh+cx, +hh+cy, -dh+cz, 0.0, 0.0, -1.0, 0.0, 0.0);\n    stream.pushVertex(-wh+cx, +hh+cy, +dh+cz, 1.0, 0.0, -1.0, 0.0, 0.0);\n    stream.pushVertex(-wh+cx, -hh+cy, +dh+cz, 1.0, 1.0, -1.0, 0.0, 0.0);\n\n    // Right\n    idx = stream.nextVertexIndex;\n    stream.pushTriangle(idx, idx+1, idx+2);\n    stream.pushTriangle(idx, idx+2, idx+3);\n\n    stream.pushVertex(+wh+cx, -hh+cy, -dh+cz, 1.0, 1.0, 1.0, 0.0, 0.0);\n    stream.pushVertex(+wh+cx, +hh+cy, -dh+cz, 1.0, 0.0, 1.0, 0.0, 0.0);\n    stream.pushVertex(+wh+cx, +hh+cy, +dh+cz, 0.0, 0.0, 1.0, 0.0, 0.0);\n    stream.pushVertex(+wh+cx, -hh+cy, +dh+cz, 0.0, 1.0, 1.0, 0.0, 0.0);\n\n    // Back\n    idx = stream.nextVertexIndex;\n    stream.pushTriangle(idx, idx+2, idx+1);\n    stream.pushTriangle(idx, idx+3, idx+2);\n\n    stream.pushVertex(-wh+cx, -hh+cy, -dh+cz, 1.0, 1.0, 0.0, 0.0, -1.0);\n    stream.pushVertex(+wh+cx, -hh+cy, -dh+cz, 0.0, 1.0, 0.0, 0.0, -1.0);\n    stream.pushVertex(+wh+cx, +hh+cy, -dh+cz, 0.0, 0.0, 0.0, 0.0, -1.0);\n    stream.pushVertex(-wh+cx, +hh+cy, -dh+cz, 1.0, 0.0, 0.0, 0.0, -1.0);\n\n    // Front\n    idx = stream.nextVertexIndex;\n    stream.pushTriangle(idx, idx+1, idx+2);\n    stream.pushTriangle(idx, idx+2, idx+3);\n\n    stream.pushVertex(-wh+cx, -hh+cy, +dh+cz, 0.0, 1.0, 0.0, 0.0, 1.0);\n    stream.pushVertex(+wh+cx, -hh+cy, +dh+cz, 1.0, 1.0, 0.0, 0.0, 1.0);\n    stream.pushVertex(+wh+cx, +hh+cy, +dh+cz, 1.0, 0.0, 0.0, 0.0, 1.0);\n    stream.pushVertex(-wh+cx, +hh+cy, +dh+cz, 0.0, 0.0, 0.0, 0.0, 1.0);\n\n    stream.endGeometry();\n  }\n\n  pushCube(center = [0, 0, 0], size = 1.0) {\n    let hs = size * 0.5;\n    this.pushBox([center[0] - hs, center[1] - hs, center[2] - hs],\n                 [center[0] + hs, center[1] + hs, center[2] + hs]);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/geometry/box-builder.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {Material} from '../core/material.js';\nimport {ATTRIB_MASK} from '../core/renderer.js';\n\nconst VERTEX_SOURCE = `\nattribute vec3 POSITION, NORMAL;\nattribute vec2 TEXCOORD_0, TEXCOORD_1;\n\nuniform vec3 CAMERA_POSITION;\nuniform vec3 LIGHT_DIRECTION;\n\nvarying vec3 vLight; // Vector from vertex to light.\nvarying vec3 vView; // Vector from vertex to camera.\nvarying vec2 vTex;\n\n#ifdef USE_NORMAL_MAP\nattribute vec4 TANGENT;\nvarying mat3 vTBN;\n#else\nvarying vec3 vNorm;\n#endif\n\n#ifdef USE_VERTEX_COLOR\nattribute vec4 COLOR_0;\nvarying vec4 vCol;\n#endif\n\nvec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n  vec3 n = normalize(vec3(model * vec4(NORMAL, 0.0)));\n#ifdef USE_NORMAL_MAP\n  vec3 t = normalize(vec3(model * vec4(TANGENT.xyz, 0.0)));\n  vec3 b = cross(n, t) * TANGENT.w;\n  vTBN = mat3(t, b, n);\n#else\n  vNorm = n;\n#endif\n\n#ifdef USE_VERTEX_COLOR\n  vCol = COLOR_0;\n#endif\n\n  vTex = TEXCOORD_0;\n  vec4 mPos = model * vec4(POSITION, 1.0);\n  vLight = -LIGHT_DIRECTION;\n  vView = CAMERA_POSITION - mPos.xyz;\n  return proj * view * mPos;\n}`;\n\n// These equations are borrowed with love from this docs from Epic because I\n// just don't have anything novel to bring to the PBR scene.\n// http://blog.selfshadow.com/publications/s2013-shading-course/karis/s2013_pbs_epic_notes_v2.pdf\nconst EPIC_PBR_FUNCTIONS = `\nvec3 lambertDiffuse(vec3 cDiff) {\n  return cDiff / M_PI;\n}\n\nfloat specD(float a, float nDotH) {\n  float aSqr = a * a;\n  float f = ((nDotH * nDotH) * (aSqr - 1.0) + 1.0);\n  return aSqr / (M_PI * f * f);\n}\n\nfloat specG(float roughness, float nDotL, float nDotV) {\n  float k = (roughness + 1.0) * (roughness + 1.0) / 8.0;\n  float gl = nDotL / (nDotL * (1.0 - k) + k);\n  float gv = nDotV / (nDotV * (1.0 - k) + k);\n  return gl * gv;\n}\n\nvec3 specF(float vDotH, vec3 F0) {\n  float exponent = (-5.55473 * vDotH - 6.98316) * vDotH;\n  float base = 2.0;\n  return F0 + (1.0 - F0) * pow(base, exponent);\n}`;\n\nconst FRAGMENT_SOURCE = `\n#define M_PI 3.14159265\n\nuniform vec4 baseColorFactor;\n#ifdef USE_BASE_COLOR_MAP\nuniform sampler2D baseColorTex;\n#endif\n\nvarying vec3 vLight;\nvarying vec3 vView;\nvarying vec2 vTex;\n\n#ifdef USE_VERTEX_COLOR\nvarying vec4 vCol;\n#endif\n\n#ifdef USE_NORMAL_MAP\nuniform sampler2D normalTex;\nvarying mat3 vTBN;\n#else\nvarying vec3 vNorm;\n#endif\n\n#ifdef USE_METAL_ROUGH_MAP\nuniform sampler2D metallicRoughnessTex;\n#endif\nuniform vec2 metallicRoughnessFactor;\n\n#ifdef USE_OCCLUSION\nuniform sampler2D occlusionTex;\nuniform float occlusionStrength;\n#endif\n\n#ifdef USE_EMISSIVE_TEXTURE\nuniform sampler2D emissiveTex;\n#endif\nuniform vec3 emissiveFactor;\n\nuniform vec3 LIGHT_COLOR;\n\nconst vec3 dielectricSpec = vec3(0.04);\nconst vec3 black = vec3(0.0);\n\n${EPIC_PBR_FUNCTIONS}\n\nvec4 fragment_main() {\n#ifdef USE_BASE_COLOR_MAP\n  vec4 baseColor = texture2D(baseColorTex, vTex) * baseColorFactor;\n#else\n  vec4 baseColor = baseColorFactor;\n#endif\n\n#ifdef USE_VERTEX_COLOR\n  baseColor *= vCol;\n#endif\n\n#ifdef USE_NORMAL_MAP\n  vec3 n = texture2D(normalTex, vTex).rgb;\n  n = normalize(vTBN * (2.0 * n - 1.0));\n#else\n  vec3 n = normalize(vNorm);\n#endif\n\n#ifdef FULLY_ROUGH\n  float metallic = 0.0;\n#else\n  float metallic = metallicRoughnessFactor.x;\n#endif\n\n  float roughness = metallicRoughnessFactor.y;\n\n#ifdef USE_METAL_ROUGH_MAP\n  vec4 metallicRoughness = texture2D(metallicRoughnessTex, vTex);\n  metallic *= metallicRoughness.b;\n  roughness *= metallicRoughness.g;\n#endif\n  \n  vec3 l = normalize(vLight);\n  vec3 v = normalize(vView);\n  vec3 h = normalize(l+v);\n\n  float nDotL = clamp(dot(n, l), 0.001, 1.0);\n  float nDotV = abs(dot(n, v)) + 0.001;\n  float nDotH = max(dot(n, h), 0.0);\n  float vDotH = max(dot(v, h), 0.0);\n\n  // From GLTF Spec\n  vec3 cDiff = mix(baseColor.rgb * (1.0 - dielectricSpec.r), black, metallic); // Diffuse color\n  vec3 F0 = mix(dielectricSpec, baseColor.rgb, metallic); // Specular color\n  float a = roughness * roughness;\n\n#ifdef FULLY_ROUGH\n  vec3 specular = F0 * 0.45;\n#else\n  vec3 F = specF(vDotH, F0);\n  float D = specD(a, nDotH);\n  float G = specG(roughness, nDotL, nDotV);\n  vec3 specular = (D * F * G) / (4.0 * nDotL * nDotV);\n#endif\n  float halfLambert = dot(n, l) * 0.5 + 0.5;\n  halfLambert *= halfLambert;\n\n  vec3 color = (halfLambert * LIGHT_COLOR * lambertDiffuse(cDiff)) + specular;\n\n#ifdef USE_OCCLUSION\n  float occlusion = texture2D(occlusionTex, vTex).r;\n  color = mix(color, color * occlusion, occlusionStrength);\n#endif\n  \n  vec3 emissive = emissiveFactor;\n#ifdef USE_EMISSIVE_TEXTURE\n  emissive *= texture2D(emissiveTex, vTex).rgb;\n#endif\n  color += emissive;\n\n  // gamma correction\n  color = pow(color, vec3(1.0/2.2));\n\n  return vec4(color, baseColor.a);\n}`;\n\nexport class PbrMaterial extends Material {\n  constructor() {\n    super();\n\n    this.baseColor = this.defineSampler('baseColorTex');\n    this.metallicRoughness = this.defineSampler('metallicRoughnessTex');\n    this.normal = this.defineSampler('normalTex');\n    this.occlusion = this.defineSampler('occlusionTex');\n    this.emissive = this.defineSampler('emissiveTex');\n\n    this.baseColorFactor = this.defineUniform('baseColorFactor', [1.0, 1.0, 1.0, 1.0]);\n    this.metallicRoughnessFactor = this.defineUniform('metallicRoughnessFactor', [1.0, 1.0]);\n    this.occlusionStrength = this.defineUniform('occlusionStrength', 1.0);\n    this.emissiveFactor = this.defineUniform('emissiveFactor', [0, 0, 0]);\n  }\n\n  get materialName() {\n    return 'PBR';\n  }\n\n  get vertexSource() {\n    return VERTEX_SOURCE;\n  }\n\n  get fragmentSource() {\n    return FRAGMENT_SOURCE;\n  }\n\n  getProgramDefines(renderPrimitive) {\n    let programDefines = {};\n\n    if (renderPrimitive._attributeMask & ATTRIB_MASK.COLOR_0) {\n      programDefines['USE_VERTEX_COLOR'] = 1;\n    }\n\n    if (renderPrimitive._attributeMask & ATTRIB_MASK.TEXCOORD_0) {\n      if (this.baseColor.texture) {\n        programDefines['USE_BASE_COLOR_MAP'] = 1;\n      }\n\n      if (this.normal.texture && (renderPrimitive._attributeMask & ATTRIB_MASK.TANGENT)) {\n        programDefines['USE_NORMAL_MAP'] = 1;\n      }\n\n      if (this.metallicRoughness.texture) {\n        programDefines['USE_METAL_ROUGH_MAP'] = 1;\n      }\n\n      if (this.occlusion.texture) {\n        programDefines['USE_OCCLUSION'] = 1;\n      }\n\n      if (this.emissive.texture) {\n        programDefines['USE_EMISSIVE_TEXTURE'] = 1;\n      }\n    }\n\n    if ((!this.metallicRoughness.texture ||\n         !(renderPrimitive._attributeMask & ATTRIB_MASK.TEXCOORD_0)) &&\n        this.metallicRoughnessFactor.value[1] == 1.0) {\n      programDefines['FULLY_ROUGH'] = 1;\n    }\n\n    return programDefines;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/materials/pbr.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {Material} from '../core/material.js';\nimport {Node} from '../core/node.js';\nimport {PrimitiveStream} from '../geometry/primitive-stream.js';\n\nconst BUTTON_SIZE = 0.1;\nconst BUTTON_CORNER_RADIUS = 0.025;\nconst BUTTON_CORNER_SEGMENTS = 8;\nconst BUTTON_ICON_SIZE = 0.07;\nconst BUTTON_LAYER_DISTANCE = 0.005;\nconst BUTTON_COLOR = 0.75;\nconst BUTTON_ALPHA = 0.85;\nconst BUTTON_HOVER_COLOR = 0.9;\nconst BUTTON_HOVER_ALPHA = 1.0;\nconst BUTTON_HOVER_SCALE = 1.1;\nconst BUTTON_HOVER_TRANSITION_TIME_MS = 200;\n\nclass ButtonMaterial extends Material {\n  constructor() {\n    super();\n\n    this.state.blend = true;\n\n    this.defineUniform('hoverAmount', 0);\n  }\n\n  get materialName() {\n    return 'BUTTON_MATERIAL';\n  }\n\n  get vertexSource() {\n    return `\n    attribute vec3 POSITION;\n\n    uniform float hoverAmount;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      float scale = mix(1.0, ${BUTTON_HOVER_SCALE}, hoverAmount);\n      vec4 pos = vec4(POSITION.x * scale, POSITION.y * scale, POSITION.z * (scale + (hoverAmount * 0.2)), 1.0);\n      return proj * view * model * pos;\n    }`;\n  }\n\n  get fragmentSource() {\n    return `\n    uniform float hoverAmount;\n\n    const vec4 default_color = vec4(${BUTTON_COLOR}, ${BUTTON_COLOR}, ${BUTTON_COLOR}, ${BUTTON_ALPHA});\n    const vec4 hover_color = vec4(${BUTTON_HOVER_COLOR}, ${BUTTON_HOVER_COLOR},\n                                  ${BUTTON_HOVER_COLOR}, ${BUTTON_HOVER_ALPHA});\n\n    vec4 fragment_main() {\n      return mix(default_color, hover_color, hoverAmount);\n    }`;\n  }\n}\n\nclass ButtonIconMaterial extends Material {\n  constructor() {\n    super();\n\n    this.state.blend = true;\n\n    this.defineUniform('hoverAmount', 0);\n    this.icon = this.defineSampler('icon');\n  }\n\n  get materialName() {\n    return 'BUTTON_ICON_MATERIAL';\n  }\n\n  get vertexSource() {\n    return `\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    uniform float hoverAmount;\n\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vTexCoord = TEXCOORD_0;\n      float scale = mix(1.0, ${BUTTON_HOVER_SCALE}, hoverAmount);\n      vec4 pos = vec4(POSITION.x * scale, POSITION.y * scale, POSITION.z * (scale + (hoverAmount * 0.2)), 1.0);\n      return proj * view * model * pos;\n    }`;\n  }\n\n  get fragmentSource() {\n    return `\n    uniform sampler2D icon;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(icon, vTexCoord);\n    }`;\n  }\n}\n\nexport class ButtonNode extends Node {\n  constructor(iconTexture, callback) {\n    super();\n\n    // All buttons are selectable by default.\n    this.selectable = true;\n\n    this._selectHandler = callback;\n    this._iconTexture = iconTexture;\n    this._hovered = false;\n    this._hoverT = 0;\n  }\n\n  get iconTexture() {\n    return this._iconTexture;\n  }\n\n  set iconTexture(value) {\n    if (this._iconTexture == value) {\n      return;\n    }\n\n    this._iconTexture = value;\n    this._iconRenderPrimitive.samplers.icon.texture = value;\n  }\n\n  onRendererChanged(renderer) {\n    let stream = new PrimitiveStream();\n\n    let hd = BUTTON_LAYER_DISTANCE * 0.5;\n\n    // Build a rounded rect for the background.\n    let hs = BUTTON_SIZE * 0.5;\n    let ihs = hs - BUTTON_CORNER_RADIUS;\n    stream.startGeometry();\n\n    // Rounded corners and sides\n    let segments = BUTTON_CORNER_SEGMENTS * 4;\n    for (let i = 0; i < segments; ++i) {\n      let rad = i * ((Math.PI * 2.0) / segments);\n      let x = Math.cos(rad) * BUTTON_CORNER_RADIUS;\n      let y = Math.sin(rad) * BUTTON_CORNER_RADIUS;\n      let section = Math.floor(i / BUTTON_CORNER_SEGMENTS);\n      switch (section) {\n        case 0:\n          x += ihs;\n          y += ihs;\n          break;\n        case 1:\n          x -= ihs;\n          y += ihs;\n          break;\n        case 2:\n          x -= ihs;\n          y -= ihs;\n          break;\n        case 3:\n          x += ihs;\n          y -= ihs;\n          break;\n      }\n\n      stream.pushVertex(x, y, -hd, 0, 0, 0, 0, 1);\n\n      if (i > 1) {\n        stream.pushTriangle(0, i-1, i);\n      }\n    }\n\n    stream.endGeometry();\n\n    let buttonPrimitive = stream.finishPrimitive(renderer);\n    this._buttonRenderPrimitive = renderer.createRenderPrimitive(buttonPrimitive, new ButtonMaterial());\n    this.addRenderPrimitive(this._buttonRenderPrimitive);\n\n    // Build a simple textured quad for the foreground.\n    hs = BUTTON_ICON_SIZE * 0.5;\n    stream.clear();\n    stream.startGeometry();\n\n    stream.pushVertex(-hs, hs, hd, 0, 0, 0, 0, 1);\n    stream.pushVertex(-hs, -hs, hd, 0, 1, 0, 0, 1);\n    stream.pushVertex(hs, -hs, hd, 1, 1, 0, 0, 1);\n    stream.pushVertex(hs, hs, hd, 1, 0, 0, 0, 1);\n\n    stream.pushTriangle(0, 1, 2);\n    stream.pushTriangle(0, 2, 3);\n\n    stream.endGeometry();\n\n    let iconPrimitive = stream.finishPrimitive(renderer);\n    let iconMaterial = new ButtonIconMaterial();\n    iconMaterial.icon.texture = this._iconTexture;\n    this._iconRenderPrimitive = renderer.createRenderPrimitive(iconPrimitive, iconMaterial);\n    this.addRenderPrimitive(this._iconRenderPrimitive);\n  }\n\n  onHoverStart() {\n    this._hovered = true;\n  }\n\n  onHoverEnd() {\n    this._hovered = false;\n  }\n\n  _updateHoverState() {\n    let t = this._hoverT / BUTTON_HOVER_TRANSITION_TIME_MS;\n    // Cubic Ease In/Out\n    // TODO: Get a better animation system\n    let hoverAmount = t<.5 ? 4*t*t*t : (t-1)*(2*t-2)*(2*t-2)+1;\n    this._buttonRenderPrimitive.uniforms.hoverAmount.value = hoverAmount;\n    this._iconRenderPrimitive.uniforms.hoverAmount.value = hoverAmount;\n  }\n\n  onUpdate(timestamp, frameDelta) {\n    if (this._hovered && this._hoverT < BUTTON_HOVER_TRANSITION_TIME_MS) {\n      this._hoverT = Math.min(BUTTON_HOVER_TRANSITION_TIME_MS, this._hoverT + frameDelta);\n      this._updateHoverState();\n    } else if (!this._hovered && this._hoverT > 0) {\n      this._hoverT = Math.max(0.0, this._hoverT - frameDelta);\n      this._updateHoverState();\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/button.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {Material} from '../core/material.js';\nimport {Node} from '../core/node.js';\nimport {UrlTexture} from '../core/texture.js';\nimport {BoxBuilder} from '../geometry/box-builder.js';\n\nclass CubeSeaMaterial extends Material {\n  constructor(heavy = false) {\n    super();\n\n    this.heavy = heavy;\n\n    this.baseColor = this.defineSampler('baseColor');\n  }\n\n  get materialName() {\n    return 'CUBE_SEA';\n  }\n\n  get vertexSource() {\n    return `\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    attribute vec3 NORMAL;\n\n    varying vec2 vTexCoord;\n    varying vec3 vLight;\n\n    const vec3 lightDir = vec3(0.75, 0.5, 1.0);\n    const vec3 ambientColor = vec3(0.5, 0.5, 0.5);\n    const vec3 lightColor = vec3(0.75, 0.75, 0.75);\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec3 normalRotated = vec3(model * vec4(NORMAL, 0.0));\n      float lightFactor = max(dot(normalize(lightDir), normalRotated), 0.0);\n      vLight = ambientColor + (lightColor * lightFactor);\n      vTexCoord = TEXCOORD_0;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }`;\n  }\n\n  get fragmentSource() {\n    if (!this.heavy) {\n      return `\n      precision mediump float;\n      uniform sampler2D baseColor;\n      varying vec2 vTexCoord;\n      varying vec3 vLight;\n\n      vec4 fragment_main() {\n        return vec4(vLight, 1.0) * texture2D(baseColor, vTexCoord);\n      }`;\n    } else {\n      // Used when we want to stress the GPU a bit more.\n      // Stolen with love from https://www.clicktorelease.com/code/codevember-2016/4/\n      return `\n      precision mediump float;\n\n      uniform sampler2D diffuse;\n      varying vec2 vTexCoord;\n      varying vec3 vLight;\n\n      vec2 dimensions = vec2(64, 64);\n      float seed = 0.42;\n\n      vec2 hash( vec2 p ) {\n        p=vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)));\n        return fract(sin(p)*18.5453);\n      }\n\n      vec3 hash3( vec2 p ) {\n          vec3 q = vec3( dot(p,vec2(127.1,311.7)),\n                 dot(p,vec2(269.5,183.3)),\n                 dot(p,vec2(419.2,371.9)) );\n        return fract(sin(q)*43758.5453);\n      }\n\n      float iqnoise( in vec2 x, float u, float v ) {\n        vec2 p = floor(x);\n        vec2 f = fract(x);\n        float k = 1.0+63.0*pow(1.0-v,4.0);\n        float va = 0.0;\n        float wt = 0.0;\n        for( int j=-2; j<=2; j++ )\n          for( int i=-2; i<=2; i++ ) {\n            vec2 g = vec2( float(i),float(j) );\n            vec3 o = hash3( p + g )*vec3(u,u,1.0);\n            vec2 r = g - f + o.xy;\n            float d = dot(r,r);\n            float ww = pow( 1.0-smoothstep(0.0,1.414,sqrt(d)), k );\n            va += o.z*ww;\n            wt += ww;\n          }\n        return va/wt;\n      }\n\n      // return distance, and cell id\n      vec2 voronoi( in vec2 x ) {\n        vec2 n = floor( x );\n        vec2 f = fract( x );\n        vec3 m = vec3( 8.0 );\n        for( int j=-1; j<=1; j++ )\n          for( int i=-1; i<=1; i++ ) {\n            vec2  g = vec2( float(i), float(j) );\n            vec2  o = hash( n + g );\n            vec2  r = g - f + (0.5+0.5*sin(seed+6.2831*o));\n            float d = dot( r, r );\n            if( d<m.x )\n              m = vec3( d, o );\n          }\n        return vec2( sqrt(m.x), m.y+m.z );\n      }\n\n      vec4 fragment_main() {\n        vec2 uv = ( vTexCoord );\n        uv *= vec2( 10., 10. );\n        uv += seed;\n        vec2 p = 0.5 - 0.5*sin( 0.*vec2(1.01,1.71) );\n\n        vec2 c = voronoi( uv );\n        vec3 col = vec3( c.y / 2. );\n\n        float f = iqnoise( 1. * uv + c.y, p.x, p.y );\n        col *= 1.0 + .25 * vec3( f );\n\n        return vec4(vLight, 1.0) * texture2D(diffuse, vTexCoord) * vec4( col, 1. );\n      }`;\n    }\n  }\n}\n\nexport class CubeSeaNode extends Node {\n  constructor(options = {}) {\n    super();\n\n    // Test variables\n    // If true, use a very heavyweight shader to stress the GPU.\n    this.heavyGpu = !!options.heavyGpu;\n\n    // Number and size of the static cubes. Warning, large values\n    // don't render right due to overflow of the int16 indices.\n    this.cubeCount = options.cubeCount || (this.heavyGpu ? 12 : 10);\n    this.cubeScale = options.cubeScale || 1.0;\n\n    // Draw only half the world cubes. Helps test variable render cost\n    // when combined with heavyGpu.\n    this.halfOnly = !!options.halfOnly;\n\n    // Automatically spin the world cubes. Intended for automated testing,\n    // not recommended for viewing in a headset.\n    this.autoRotate = !!options.autoRotate;\n\n    this._texture = new UrlTexture(options.imageUrl || 'media/textures/cube-sea.png');\n\n    this._material = new CubeSeaMaterial(this.heavyGpu);\n    this._material.baseColor.texture = this._texture;\n\n    this._renderPrimitive = null;\n  }\n\n  onRendererChanged(renderer) {\n    this._renderPrimitive = null;\n\n    let boxBuilder = new BoxBuilder();\n\n    // Build the spinning \"hero\" cubes\n    boxBuilder.pushCube([0, 0.25, -0.8], 0.1);\n    boxBuilder.pushCube([0.8, 0.25, 0], 0.1);\n    boxBuilder.pushCube([0, 0.25, 0.8], 0.1);\n    boxBuilder.pushCube([-0.8, 0.25, 0], 0.1);\n\n    let heroPrimitive = boxBuilder.finishPrimitive(renderer);\n\n    this.heroNode = renderer.createMesh(heroPrimitive, this._material);\n\n    this.rebuildCubes(boxBuilder);\n\n    this.cubeSeaNode = new Node();\n    this.cubeSeaNode.addRenderPrimitive(this._renderPrimitive);\n\n    this.addNode(this.cubeSeaNode);\n    this.addNode(this.heroNode);\n\n    return this.waitForComplete();\n  }\n\n  rebuildCubes(boxBuilder) {\n    if (!this._renderer) {\n      return;\n    }\n\n    if (!boxBuilder) {\n      boxBuilder = new BoxBuilder();\n    } else {\n      boxBuilder.clear();\n    }\n\n    let size = 0.4 * this.cubeScale;\n\n    // Build the cube sea\n    let halfGrid = this.cubeCount * 0.5;\n    for (let x = 0; x < this.cubeCount; ++x) {\n      for (let y = 0; y < this.cubeCount; ++y) {\n        for (let z = 0; z < this.cubeCount; ++z) {\n          let pos = [x - halfGrid, y - halfGrid, z - halfGrid];\n          // Only draw cubes on one side. Useful for testing variable render\n          // cost that depends on view direction.\n          if (this.halfOnly && pos[0] < 0) {\n            continue;\n          }\n\n          // Don't place a cube in the center of the grid.\n          if (pos[0] == 0 && pos[1] == 0 && pos[2] == 0) {\n            continue;\n          }\n\n          boxBuilder.pushCube(pos, size);\n        }\n      }\n    }\n\n    if (this.cubeCount > 12) {\n      // Each cube has 6 sides with 2 triangles and 3 indices per triangle, so\n      // the total number of indices needed is cubeCount^3 * 36. This exceeds\n      // the short index range past 12 cubes.\n      boxBuilder.indexType = 5125; // gl.UNSIGNED_INT\n    }\n    let cubeSeaPrimitive = boxBuilder.finishPrimitive(this._renderer);\n\n    if (!this._renderPrimitive) {\n      this._renderPrimitive = this._renderer.createRenderPrimitive(cubeSeaPrimitive, this._material);\n    } else {\n      this._renderPrimitive.setPrimitive(cubeSeaPrimitive);\n    }\n  }\n\n  onUpdate(timestamp, frameDelta) {\n    if (this.autoRotate) {\n      mat4.fromRotation(this.cubeSeaNode.matrix, timestamp / 500, [0, -1, 0]);\n    }\n    mat4.fromRotation(this.heroNode.matrix, timestamp / 2000, [0, 1, 0]);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/cube-sea.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {Node} from '../core/node.js';\nimport {Gltf2Loader} from '../loaders/gltf2.js';\n\n// Using a weak map here allows us to cache a loader per-renderer without\n// modifying the renderer object or leaking memory when it's garbage collected.\nlet gltfLoaderMap = new WeakMap();\n\nexport class Gltf2Node extends Node {\n  constructor(options) {\n    super();\n    this._url = options.url;\n\n    this._promise = null;\n    this._resolver = null;\n    this._rejecter = null;\n  }\n\n  onRendererChanged(renderer) {\n    let loader = gltfLoaderMap.get(renderer);\n    if (!loader) {\n      loader = new Gltf2Loader(renderer);\n      gltfLoaderMap.set(renderer, loader);\n    }\n\n    // Do we have a previously resolved promise? If so clear it.\n    if (!this._resolver && this._promise) {\n      this._promise = null;\n    }\n\n    this._ensurePromise();\n\n    loader.loadFromUrl(this._url).then((sceneNode) => {\n      this.addNode(sceneNode);\n      this._resolver(sceneNode.waitForComplete());\n      this._resolver = null;\n      this._rejecter = null;\n    }).catch((err) => {\n      this._rejecter(err);\n      this._resolver = null;\n      this._rejecter = null;\n    });\n  }\n\n  _ensurePromise() {\n    if (!this._promise) {\n      this._promise = new Promise((resolve, reject) => {\n        this._resolver = resolve;\n        this._rejecter = reject;\n      });\n    }\n    return this._promise;\n  }\n\n  waitForComplete() {\n    return this._ensurePromise();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/gltf2.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {PbrMaterial} from '../materials/pbr.js';\nimport {Node} from '../core/node.js';\nimport {Primitive, PrimitiveAttribute} from '../core/primitive.js';\nimport {ImageTexture, ColorTexture} from '../core/texture.js';\n\nconst GL = WebGLRenderingContext; // For enums\n\nconst GLB_MAGIC = 0x46546C67;\nconst CHUNK_TYPE = {\n  JSON: 0x4E4F534A,\n  BIN: 0x004E4942,\n};\n\nfunction isAbsoluteUri(uri) {\n  let absRegEx = new RegExp('^'+window.location.protocol, 'i');\n  return !!uri.match(absRegEx);\n}\n\nfunction isDataUri(uri) {\n  let dataRegEx = /^data:/;\n  return !!uri.match(dataRegEx);\n}\n\nfunction resolveUri(uri, baseUrl) {\n  if (isAbsoluteUri(uri) || isDataUri(uri)) {\n      return uri;\n  }\n  return baseUrl + uri;\n}\n\nfunction getComponentCount(type) {\n  switch (type) {\n    case 'SCALAR': return 1;\n    case 'VEC2': return 2;\n    case 'VEC3': return 3;\n    case 'VEC4': return 4;\n    default: return 0;\n  }\n}\n\n/**\n * Gltf2SceneLoader\n * Loads glTF 2.0 scenes into a renderable node tree.\n */\n\nexport class Gltf2Loader {\n  constructor(renderer) {\n    this.renderer = renderer;\n    this._gl = renderer._gl;\n  }\n\n  loadFromUrl(url) {\n    return fetch(url)\n        .then((response) => {\n          let i = url.lastIndexOf('/');\n          let baseUrl = (i !== 0) ? url.substring(0, i + 1) : '';\n\n          if (url.endsWith('.gltf')) {\n            return response.json().then((json) => {\n              return this.loadFromJson(json, baseUrl);\n            });\n          } else if (url.endsWith('.glb')) {\n            return response.arrayBuffer().then((arrayBuffer) => {\n              return this.loadFromBinary(arrayBuffer, baseUrl);\n            });\n          } else {\n            throw new Error('Unrecognized file extension');\n          }\n        });\n  }\n\n  loadFromBinary(arrayBuffer, baseUrl) {\n    let headerView = new DataView(arrayBuffer, 0, 12);\n    let magic = headerView.getUint32(0, true);\n    let version = headerView.getUint32(4, true);\n    let length = headerView.getUint32(8, true);\n\n    if (magic != GLB_MAGIC) {\n      throw new Error('Invalid magic string in binary header.');\n    }\n\n    if (version != 2) {\n      throw new Error('Incompatible version in binary header.');\n    }\n\n    let chunks = {};\n    let chunkOffset = 12;\n    while (chunkOffset < length) {\n      let chunkHeaderView = new DataView(arrayBuffer, chunkOffset, 8);\n      let chunkLength = chunkHeaderView.getUint32(0, true);\n      let chunkType = chunkHeaderView.getUint32(4, true);\n      chunks[chunkType] = arrayBuffer.slice(chunkOffset + 8, chunkOffset + 8 + chunkLength);\n      chunkOffset += chunkLength + 8;\n    }\n\n    if (!chunks[CHUNK_TYPE.JSON]) {\n      throw new Error('File contained no json chunk.');\n    }\n\n    let decoder = new TextDecoder('utf-8');\n    let jsonString = decoder.decode(chunks[CHUNK_TYPE.JSON]);\n    let json = JSON.parse(jsonString);\n    return this.loadFromJson(json, baseUrl, chunks[CHUNK_TYPE.BIN]);\n  }\n\n  loadFromJson(json, baseUrl, binaryChunk) {\n    if (!json.asset) {\n      throw new Error('Missing asset description.');\n    }\n\n    if (json.asset.minVersion != '2.0' && json.asset.version != '2.0') {\n      throw new Error('Incompatible asset version.');\n    }\n\n    let buffers = [];\n    if (binaryChunk) {\n      buffers[0] = new Gltf2Resource({}, baseUrl, binaryChunk);\n    } else {\n      for (let buffer of json.buffers) {\n        buffers.push(new Gltf2Resource(buffer, baseUrl));\n      }\n    }\n\n    let bufferViews = [];\n    for (let bufferView of json.bufferViews) {\n      bufferViews.push(new Gltf2BufferView(bufferView, buffers));\n    }\n\n    let images = [];\n    if (json.images) {\n      for (let image of json.images) {\n        images.push(new Gltf2Resource(image, baseUrl));\n      }\n    }\n\n    let textures = [];\n    if (json.textures) {\n      for (let texture of json.textures) {\n        let image = images[texture.source];\n        let glTexture = image.texture(bufferViews);\n        if (texture.sampler) {\n          let sampler = sampler[texture.sampler];\n          glTexture.sampler.minFilter = sampler.minFilter;\n          glTexture.sampler.magFilter = sampler.magFilter;\n          glTexture.sampler.wrapS = sampler.wrapS;\n          glTexture.sampler.wrapT = sampler.wrapT;\n        }\n        textures.push(glTexture);\n      }\n    }\n\n    function getTexture(textureInfo) {\n      if (!textureInfo) {\n        return null;\n      }\n      return textures[textureInfo.index];\n    }\n\n    let materials = [];\n    if (json.materials) {\n      for (let material of json.materials) {\n        let glMaterial = new PbrMaterial();\n        let pbr = material.pbrMetallicRoughness || {};\n\n        glMaterial.baseColorFactor.value = pbr.baseColorFactor || [1, 1, 1, 1];\n        glMaterial.baseColor.texture = getTexture(pbr.baseColorTexture);\n        glMaterial.metallicRoughnessFactor.value = [\n          pbr.metallicFactor || 1.0,\n          pbr.roughnessFactor || 1.0,\n        ];\n        glMaterial.metallicRoughness.texture = getTexture(pbr.metallicRoughnessTexture);\n        glMaterial.normal.texture = getTexture(json.normalTexture);\n        glMaterial.occlusion.texture = getTexture(json.occlusionTexture);\n        glMaterial.occlusionStrength.value = (json.occlusionTexture && json.occlusionTexture.strength) ?\n                                              json.occlusionTexture.strength : 1.0;\n        glMaterial.emissiveFactor.value = material.emissiveFactor || [0, 0, 0];\n        glMaterial.emissive.texture = getTexture(json.emissiveTexture);\n        if (!glMaterial.emissive.texture && json.emissiveFactor) {\n          glMaterial.emissive.texture = new ColorTexture(1.0, 1.0, 1.0, 1.0);\n        }\n\n        switch (material.alphaMode) {\n          case 'BLEND':\n            glMaterial.state.blend = true;\n            break;\n          case 'MASK':\n            // Not really supported.\n            glMaterial.state.blend = true;\n            break;\n          default: // Includes 'OPAQUE'\n            glMaterial.state.blend = false;\n        }\n\n        // glMaterial.alpha_mode = material.alphaMode;\n        // glMaterial.alpha_cutoff = material.alphaCutoff;\n        glMaterial.state.cullFace = !(material.doubleSided);\n\n        materials.push(glMaterial);\n      }\n    }\n\n    let accessors = json.accessors;\n\n    let meshes = [];\n    for (let mesh of json.meshes) {\n      let glMesh = new Gltf2Mesh();\n      meshes.push(glMesh);\n\n      for (let primitive of mesh.primitives) {\n        let material = null;\n        if ('material' in primitive) {\n          material = materials[primitive.material];\n        } else {\n          // Create a \"default\" material if the primitive has none.\n          material = new PbrMaterial();\n        }\n\n        let attributes = [];\n        let elementCount = 0;\n        /* let glPrimitive = new Gltf2Primitive(primitive, material);\n        glMesh.primitives.push(glPrimitive); */\n\n        let min = null;\n        let max = null;\n\n        for (let name in primitive.attributes) {\n          let accessor = accessors[primitive.attributes[name]];\n          let bufferView = bufferViews[accessor.bufferView];\n          elementCount = accessor.count;\n\n          let glAttribute = new PrimitiveAttribute(\n            name,\n            bufferView.renderBuffer(this.renderer, GL.ARRAY_BUFFER),\n            getComponentCount(accessor.type),\n            accessor.componentType,\n            bufferView.byteStride || 0,\n            accessor.byteOffset || 0\n          );\n          glAttribute.normalized = accessor.normalized || false;\n\n          if (name == 'POSITION') {\n            min = accessor.min;\n            max = accessor.max;\n          }\n\n          attributes.push(glAttribute);\n        }\n\n        let glPrimitive = new Primitive(attributes, elementCount, primitive.mode);\n\n        if ('indices' in primitive) {\n          let accessor = accessors[primitive.indices];\n          let bufferView = bufferViews[accessor.bufferView];\n\n          glPrimitive.setIndexBuffer(\n            bufferView.renderBuffer(this.renderer, GL.ELEMENT_ARRAY_BUFFER),\n            accessor.byteOffset || 0,\n            accessor.componentType\n          );\n          glPrimitive.indexType = accessor.componentType;\n          glPrimitive.indexByteOffset = accessor.byteOffset || 0;\n          glPrimitive.elementCount = accessor.count;\n        }\n\n        if (min && max) {\n          glPrimitive.setBounds(min, max);\n        }\n\n        // After all the attributes have been processed, get a program that is\n        // appropriate for both the material and the primitive attributes.\n        glMesh.primitives.push(\n            this.renderer.createRenderPrimitive(glPrimitive, material));\n      }\n    }\n\n    let sceneNode = new Node();\n    let scene = json.scenes[json.scene];\n    for (let nodeId of scene.nodes) {\n      let node = json.nodes[nodeId];\n      sceneNode.addNode(\n          this.processNodes(node, json.nodes, meshes));\n    }\n\n    return sceneNode;\n  }\n\n  processNodes(node, nodes, meshes) {\n    let glNode = new Node();\n    glNode.name = node.name;\n\n    if ('mesh' in node) {\n      let mesh = meshes[node.mesh];\n      for (let primitive of mesh.primitives) {\n        glNode.addRenderPrimitive(primitive);\n      }\n    }\n\n    if (node.matrix) {\n      glNode.matrix = new Float32Array(node.matrix);\n    } else if (node.translation || node.rotation || node.scale) {\n      if (node.translation) {\n        glNode.translation = new Float32Array(node.translation);\n      }\n\n      if (node.rotation) {\n        glNode.rotation = new Float32Array(node.rotation);\n      }\n\n      if (node.scale) {\n        glNode.scale = new Float32Array(node.scale);\n      }\n    }\n\n    if (node.children) {\n      for (let nodeId of node.children) {\n        let node = nodes[nodeId];\n        glNode.addNode(this.processNodes(node, nodes, meshes));\n      }\n    }\n\n    return glNode;\n  }\n}\n\nclass Gltf2Mesh {\n  constructor() {\n    this.primitives = [];\n  }\n}\n\nclass Gltf2BufferView {\n  constructor(json, buffers) {\n    this.buffer = buffers[json.buffer];\n    this.byteOffset = json.byteOffset || 0;\n    this.byteLength = json.byteLength || null;\n    this.byteStride = json.byteStride;\n\n    this._viewPromise = null;\n    this._renderBuffer = null;\n  }\n\n  dataView() {\n    if (!this._viewPromise) {\n      this._viewPromise = this.buffer.arrayBuffer().then((arrayBuffer) => {\n        return new DataView(arrayBuffer, this.byteOffset, this.byteLength);\n      });\n    }\n    return this._viewPromise;\n  }\n\n  renderBuffer(renderer, target) {\n    if (!this._renderBuffer) {\n      this._renderBuffer = renderer.createRenderBuffer(target, this.dataView());\n    }\n    return this._renderBuffer;\n  }\n}\n\nclass Gltf2Resource {\n  constructor(json, baseUrl, arrayBuffer) {\n    this.json = json;\n    this.baseUrl = baseUrl;\n\n    this._dataPromise = null;\n    this._texture = null;\n    if (arrayBuffer) {\n      this._dataPromise = Promise.resolve(arrayBuffer);\n    }\n  }\n\n  arrayBuffer() {\n    if (!this._dataPromise) {\n      if (isDataUri(this.json.uri)) {\n        let base64String = this.json.uri.replace('data:application/octet-stream;base64,', '');\n        let binaryArray = Uint8Array.from(atob(base64String), (c) => c.charCodeAt(0));\n        this._dataPromise = Promise.resolve(binaryArray.buffer);\n        return this._dataPromise;\n      }\n\n      this._dataPromise = fetch(resolveUri(this.json.uri, this.baseUrl))\n          .then((response) => response.arrayBuffer());\n    }\n    return this._dataPromise;\n  }\n\n  texture(bufferViews) {\n    if (!this._texture) {\n      let img = new Image();\n      this._texture = new ImageTexture(img);\n\n      if (this.json.uri) {\n        if (isDataUri(this.json.uri)) {\n          img.src = this.json.uri;\n        } else {\n          img.src = `${this.baseUrl}${this.json.uri}`;\n        }\n      } else {\n        let view = bufferViews[this.json.bufferView];\n        view.dataView().then((dataView) => {\n          let blob = new Blob([dataView], {type: this.json.mimeType});\n          img.src = window.URL.createObjectURL(blob);\n        });\n      }\n    }\n    return this._texture;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/loaders/gltf2.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nNode for displaying 360 equirect images as a skybox.\n*/\n\nimport {Material, RENDER_ORDER} from '../core/material.js';\nimport {Primitive, PrimitiveAttribute} from '../core/primitive.js';\nimport {Node} from '../core/node.js';\nimport {UrlTexture} from '../core/texture.js';\n\nconst GL = WebGLRenderingContext; // For enums\n\nclass SkyboxMaterial extends Material {\n  constructor() {\n    super();\n    this.renderOrder = RENDER_ORDER.SKY;\n    this.state.depthFunc = GL.LEQUAL;\n    this.state.depthMask = false;\n\n    this.image = this.defineSampler('diffuse');\n\n    this.texCoordScaleOffset = this.defineUniform('texCoordScaleOffset',\n                                                      [1.0, 1.0, 0.0, 0.0,\n                                                       1.0, 1.0, 0.0, 0.0], 4);\n  }\n\n  get materialName() {\n    return 'SKYBOX';\n  }\n\n  get vertexSource() {\n    return `\n    uniform int EYE_INDEX;\n    uniform vec4 texCoordScaleOffset[2];\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec4 scaleOffset = texCoordScaleOffset[EYE_INDEX];\n      vTexCoord = (TEXCOORD_0 * scaleOffset.xy) + scaleOffset.zw;\n      // Drop the translation portion of the view matrix\n      view[3].xyz = vec3(0.0, 0.0, 0.0);\n      vec4 out_vec = proj * view * model * vec4(POSITION, 1.0);\n\n      // Returning the W component for both Z and W forces the geometry depth to\n      // the far plane. When combined with a depth func of LEQUAL this makes the\n      // sky write to any depth fragment that has not been written to yet.\n      return out_vec.xyww;\n    }`;\n  }\n\n  get fragmentSource() {\n    return `\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(diffuse, vTexCoord);\n    }`;\n  }\n}\n\nexport class SkyboxNode extends Node {\n  constructor(options) {\n    super();\n\n    this._url = options.url;\n    this._displayMode = options.displayMode || 'mono';\n    this._rotationY = options.rotationY || 0;\n  }\n\n  onRendererChanged(renderer) {\n    let vertices = [];\n    let indices = [];\n\n    let latSegments = 40;\n    let lonSegments = 40;\n\n    // Create the vertices/indices\n    for (let i=0; i <= latSegments; ++i) {\n      let theta = i * Math.PI / latSegments;\n      let sinTheta = Math.sin(theta);\n      let cosTheta = Math.cos(theta);\n\n      let idxOffsetA = i * (lonSegments+1);\n      let idxOffsetB = (i+1) * (lonSegments+1);\n\n      for (let j=0; j <= lonSegments; ++j) {\n        let phi = (j * 2 * Math.PI / lonSegments) + this._rotationY;\n        let x = Math.sin(phi) * sinTheta;\n        let y = cosTheta;\n        let z = -Math.cos(phi) * sinTheta;\n        let u = (j / lonSegments);\n        let v = (i / latSegments);\n\n        // Vertex shader will force the geometry to the far plane, so the\n        // radius of the sphere is immaterial.\n        vertices.push(x, y, z, u, v);\n\n        if (i < latSegments && j < lonSegments) {\n          let idxA = idxOffsetA+j;\n          let idxB = idxOffsetB+j;\n\n          indices.push(idxA, idxB, idxA+1,\n                       idxB, idxB+1, idxA+1);\n        }\n      }\n    }\n\n    let vertexBuffer = renderer.createRenderBuffer(GL.ARRAY_BUFFER, new Float32Array(vertices));\n    let indexBuffer = renderer.createRenderBuffer(GL.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices));\n\n    let attribs = [\n      new PrimitiveAttribute('POSITION', vertexBuffer, 3, GL.FLOAT, 20, 0),\n      new PrimitiveAttribute('TEXCOORD_0', vertexBuffer, 2, GL.FLOAT, 20, 12),\n    ];\n\n    let primitive = new Primitive(attribs, indices.length);\n    primitive.setIndexBuffer(indexBuffer);\n\n    let material = new SkyboxMaterial();\n    material.image.texture = new UrlTexture(this._url);\n\n    switch (this._displayMode) {\n      case 'mono':\n        material.texCoordScaleOffset.value = [1.0, 1.0, 0.0, 0.0,\n                                              1.0, 1.0, 0.0, 0.0];\n        break;\n      case 'stereoTopBottom':\n        material.texCoordScaleOffset.value = [1.0, 0.5, 0.0, 0.0,\n                                              1.0, 0.5, 0.0, 0.5];\n        break;\n      case 'stereoLeftRight':\n        material.texCoordScaleOffset.value = [0.5, 1.0, 0.0, 0.0,\n                                              0.5, 1.0, 0.5, 0.0];\n        break;\n    }\n\n    let renderPrimitive = renderer.createRenderPrimitive(primitive, material);\n    this.addRenderPrimitive(renderPrimitive);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/skybox.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nNode for displaying 2D or stereo videos on a quad.\n*/\n\nimport {Material} from '../core/material.js';\nimport {Primitive, PrimitiveAttribute} from '../core/primitive.js';\nimport {Node} from '../core/node.js';\nimport {VideoTexture} from '../core/texture.js';\n\nconst GL = WebGLRenderingContext; // For enums\n\nclass VideoMaterial extends Material {\n  constructor() {\n    super();\n\n    this.image = this.defineSampler('diffuse');\n\n    this.texCoordScaleOffset = this.defineUniform('texCoordScaleOffset',\n                                                      [1.0, 1.0, 0.0, 0.0,\n                                                       1.0, 1.0, 0.0, 0.0], 4);\n  }\n\n  get materialName() {\n    return 'VIDEO_PLAYER';\n  }\n\n  get vertexSource() {\n    return `\n    uniform int EYE_INDEX;\n    uniform vec4 texCoordScaleOffset[2];\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vec4 scaleOffset = texCoordScaleOffset[EYE_INDEX];\n      vTexCoord = (TEXCOORD_0 * scaleOffset.xy) + scaleOffset.zw;\n      vec4 out_vec = proj * view * model * vec4(POSITION, 1.0);\n      return out_vec;\n    }`;\n  }\n\n  get fragmentSource() {\n    return `\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    vec4 fragment_main() {\n      return texture2D(diffuse, vTexCoord);\n    }`;\n  }\n}\n\nexport class VideoNode extends Node {\n  constructor(options) {\n    super();\n\n    this._video = options.video;\n    this._displayMode = options.displayMode || 'mono';\n\n    this._video_texture = new VideoTexture(this._video);\n  }\n\n  get aspectRatio() {\n    let width = this._video.videoWidth;\n    let height = this._video.videoHeight;\n\n    switch (this._displayMode) {\n      case 'stereoTopBottom': height *= 0.5; break;\n      case 'stereoLeftRight': width *= 0.5; break;\n    }\n\n    if (!height || !width) {\n      return 1;\n    }\n\n    return width / height;\n  }\n\n  onRendererChanged(renderer) {\n    let vertices = [\n      -1.0, 1.0, 0.0, 0.0, 0.0,\n       1.0, 1.0, 0.0, 1.0, 0.0,\n       1.0, -1.0, 0.0, 1.0, 1.0,\n      -1.0, -1.0, 0.0, 0.0, 1.0,\n    ];\n    let indices = [\n      0, 2, 1,\n      0, 3, 2,\n    ];\n\n    let vertexBuffer = renderer.createRenderBuffer(GL.ARRAY_BUFFER, new Float32Array(vertices));\n    let indexBuffer = renderer.createRenderBuffer(GL.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices));\n\n    let attribs = [\n      new PrimitiveAttribute('POSITION', vertexBuffer, 3, GL.FLOAT, 20, 0),\n      new PrimitiveAttribute('TEXCOORD_0', vertexBuffer, 2, GL.FLOAT, 20, 12),\n    ];\n\n    let primitive = new Primitive(attribs, indices.length);\n    primitive.setIndexBuffer(indexBuffer);\n    primitive.setBounds([-1.0, -1.0, 0.0], [1.0, 1.0, 0.015]);\n\n    let material = new VideoMaterial();\n    material.image.texture = this._video_texture;\n\n    switch (this._displayMode) {\n      case 'mono':\n        material.texCoordScaleOffset.value = [1.0, 1.0, 0.0, 0.0,\n                                                 1.0, 1.0, 0.0, 0.0];\n        break;\n      case 'stereoTopBottom':\n        material.texCoordScaleOffset.value = [1.0, 0.5, 0.0, 0.0,\n                                                 1.0, 0.5, 0.0, 0.5];\n        break;\n      case 'stereoLeftRight':\n        material.texCoordScaleOffset.value = [0.5, 1.0, 0.0, 0.0,\n                                                 0.5, 1.0, 0.5, 0.0];\n        break;\n    }\n\n    let renderPrimitive = renderer.createRenderPrimitive(primitive, material);\n    this.addRenderPrimitive(renderPrimitive);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/video.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {RenderView} from '../core/renderer.js';\nimport {BoundsRenderer} from '../nodes/bounds-renderer.js';\nimport {InputRenderer} from '../nodes/input-renderer.js';\nimport {StatsViewer} from '../nodes/stats-viewer.js';\nimport {Node} from '../core/node.js';\n\nexport class WebXRView extends RenderView {\n  constructor(view, pose, layer) {\n    super(\n      view ? view.projectionMatrix : null,\n      (pose && view) ? pose.getViewMatrix(view) : null,\n      (layer && view) ? layer.getViewport(view) : null,\n      view ? view.eye : 'left'\n    );\n  }\n}\n\nexport class Scene extends Node {\n  constructor() {\n    super();\n\n    this._timestamp = -1;\n    this._frameDelta = 0;\n    this._statsStanding = false;\n    this._stats = null;\n    this._statsEnabled = false;\n    this.enableStats(true); // Ensure the stats are added correctly by default.\n    this._stageBounds = null;\n    this._boundsRenderer = null;\n\n    this._inputRenderer = null;\n    this._resetInputEndFrame = true;\n\n    this._lastTimestamp = 0;\n\n    this._hoverFrame = 0;\n    this._hoveredNodes = [];\n  }\n\n  setRenderer(renderer) {\n    // Set up a non-black clear color so that we can see if something renders\n    // wrong.\n    renderer.gl.clearColor(0.1, 0.2, 0.3, 1.0);\n    this._setRenderer(renderer);\n  }\n\n  loseRenderer() {\n    if (this._renderer) {\n      this._stats = null;\n      this._renderer = null;\n      this._inputRenderer = null;\n    }\n  }\n\n  get inputRenderer() {\n    if (!this._inputRenderer) {\n      this._inputRenderer = new InputRenderer();\n      this.addNode(this._inputRenderer);\n    }\n    return this._inputRenderer;\n  }\n\n  // Helper function that automatically adds the appropriate visual elements for\n  // all input sources.\n  updateInputSources(frame, frameOfRef) {\n    // FIXME: Check for the existence of the API first. This check should be\n    // removed once the input API is part of the official spec.\n    if (!frame.session.getInputSources) {\n      return;\n    }\n\n    let inputSources = frame.session.getInputSources();\n\n    let newHoveredNodes = [];\n    let lastHoverFrame = this._hoverFrame;\n    this._hoverFrame++;\n\n    for (let inputSource of inputSources) {\n      let inputPose = frame.getInputPose(inputSource, frameOfRef);\n\n      if (!inputPose) {\n        continue;\n      }\n\n      // Any time that we have a grip matrix, we'll render a controller.\n      if (inputPose.gripMatrix) {\n        this.inputRenderer.addController(inputPose.gripMatrix);\n      }\n\n      if (inputPose.pointerMatrix) {\n        if (inputSource.pointerOrigin == 'hand') {\n          // If we have a pointer matrix and the pointer origin is the users\n          // hand (as opposed to their head or the screen) use it to render\n          // a ray coming out of the input device to indicate the pointer\n          // direction.\n          this.inputRenderer.addLaserPointer(inputPose.pointerMatrix);\n        }\n\n        // If we have a pointer matrix we can also use it to render a cursor\n        // for both handheld and gaze-based input sources.\n\n        // Check and see if the pointer is pointing at any selectable objects.\n        let hitResult = this.hitTest(inputPose.pointerMatrix);\n\n        if (hitResult) {\n          // Render a cursor at the intersection point.\n          this.inputRenderer.addCursor(hitResult.intersection);\n\n          if (hitResult.node._hoverFrameId != lastHoverFrame) {\n            hitResult.node.onHoverStart();\n          }\n          hitResult.node._hoverFrameId = this._hoverFrame;\n          newHoveredNodes.push(hitResult.node);\n        } else {\n          // Statically render the cursor 1 meters down the ray since we didn't\n          // hit anything selectable.\n          let cursorPos = vec3.fromValues(0, 0, -1.0);\n          vec3.transformMat4(cursorPos, cursorPos, inputPose.pointerMatrix);\n          this.inputRenderer.addCursor(cursorPos);\n        }\n      }\n    }\n\n    for (let hoverNode of this._hoveredNodes) {\n      if (hoverNode._hoverFrameId != this._hoverFrame) {\n        hoverNode.onHoverEnd();\n      }\n    }\n\n    this._hoveredNodes = newHoveredNodes;\n  }\n\n  handleSelect(inputSource, frame, frameOfRef) {\n    let inputPose = frame.getInputPose(inputSource, frameOfRef);\n\n    if (!inputPose) {\n      return;\n    }\n\n    this.handleSelectPointer(inputPose.pointerMatrix);\n  }\n\n  handleSelectPointer(pointerMatrix) {\n    if (pointerMatrix) {\n      // Check and see if the pointer is pointing at any selectable objects.\n      let hitResult = this.hitTest(pointerMatrix);\n\n      if (hitResult) {\n        // Render a cursor at the intersection point.\n        hitResult.node.handleSelect();\n      }\n    }\n  }\n\n  enableStats(enable) {\n    if (enable == this._statsEnabled) {\n      return;\n    }\n\n    this._statsEnabled = enable;\n\n    if (enable) {\n      this._stats = new StatsViewer();\n      this._stats.selectable = true;\n      this.addNode(this._stats);\n\n      if (this._statsStanding) {\n        this._stats.translation = [0, 1.4, -0.75];\n      } else {\n        this._stats.translation = [0, -0.3, -0.5];\n      }\n      this._stats.scale = [0.3, 0.3, 0.3];\n      quat.fromEuler(this._stats.rotation, -45.0, 0.0, 0.0);\n    } else if (!enable) {\n      if (this._stats) {\n        this.removeNode(this._stats);\n        this._stats = null;\n      }\n    }\n  }\n\n  standingStats(enable) {\n    this._statsStanding = enable;\n    if (this._stats) {\n      if (this._statsStanding) {\n        this._stats.translation = [0, 1.4, -0.75];\n      } else {\n        this._stats.translation = [0, -0.3, -0.5];\n      }\n      this._stats.scale = [0.3, 0.3, 0.3];\n      quat.fromEuler(this._stats.rotation, -45.0, 0.0, 0.0);\n    }\n  }\n\n  setBounds(stageBounds) {\n    this._stageBounds = stageBounds;\n    if (stageBounds && !this._boundsRenderer) {\n      this._boundsRenderer = new BoundsRenderer();\n      this.addNode(this._boundsRenderer);\n    }\n    if (this._boundsRenderer) {\n      this._boundsRenderer.stageBounds = stageBounds;\n    }\n  }\n\n  draw(projectionMatrix, viewMatrix, eye) {\n    let view = new RenderView();\n    view.projectionMatrix = projectionMatrix;\n    view.viewMatrix = viewMatrix;\n    if (eye) {\n      view.eye = eye;\n    }\n\n    this.drawViewArray([view]);\n  }\n\n  /** Draws the scene into the base layer of the XRFrame's session */\n  drawXRFrame(xrFrame, pose) {\n    if (!this._renderer || !pose) {\n      return;\n    }\n\n    let gl = this._renderer.gl;\n    let session = xrFrame.session;\n    // Assumed to be a XRWebGLLayer for now.\n    let layer = session.baseLayer;\n\n    if (!gl) {\n      return;\n    }\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, layer.framebuffer);\n    gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n    let views = [];\n    for (let view of xrFrame.views) {\n      views.push(new WebXRView(view, pose, layer));\n    }\n\n    this.drawViewArray(views);\n  }\n\n  drawViewArray(views) {\n    // Don't draw when we don't have a valid context\n    if (!this._renderer) {\n      return;\n    }\n\n    this._renderer.drawViews(views, this);\n  }\n\n  startFrame() {\n    let prevTimestamp = this._timestamp;\n    this._timestamp = performance.now();\n    if (this._stats) {\n      this._stats.begin();\n    }\n\n    if (prevTimestamp >= 0) {\n      this._frameDelta = this._timestamp - prevTimestamp;\n    } else {\n      this._frameDelta = 0;\n    }\n\n    this._update(this._timestamp, this._frameDelta);\n\n    return this._frameDelta;\n  }\n\n  endFrame() {\n    if (this._inputRenderer && this._resetInputEndFrame) {\n      this._inputRenderer.reset();\n    }\n\n    if (this._stats) {\n      this._stats.end();\n    }\n  }\n\n  // Override to load scene resources on construction or context restore.\n  onLoadScene(renderer) {\n    return Promise.resolve();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scenes/scene.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nThis file renders a passed in XRStageBounds object and attempts\nto render geometry on the floor to indicate where the bounds is.\nXRStageBounds' `geometry` is a series of XRStageBoundsPoints (in\nclockwise-order) with `x` and `z` properties for each.\n*/\n\nimport {Material} from '../core/material.js';\nimport {Node} from '../core/node.js';\nimport {Primitive, PrimitiveAttribute} from '../core/primitive.js';\n\nconst GL = WebGLRenderingContext; // For enums\n\nclass BoundsMaterial extends Material {\n  constructor() {\n    super();\n\n    this.state.blend = true;\n    this.state.blendFuncSrc = GL.SRC_ALPHA;\n    this.state.blendFuncDst = GL.ONE;\n    this.state.depthTest = false;\n  }\n\n  get materialName() {\n    return 'BOUNDS_RENDERER';\n  }\n\n  get vertexSource() {\n    return `\n    attribute vec2 POSITION;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      return proj * view * model * vec4(POSITION, 1.0);\n    }`;\n  }\n\n  get fragmentSource() {\n    return `\n    precision mediump float;\n\n    vec4 fragment_main() {\n      return vec4(0.0, 1.0, 0.0, 0.3);\n    }`;\n  }\n}\n\nexport class BoundsRenderer extends Node {\n  constructor() {\n    super();\n\n    this._stageBounds = null;\n  }\n\n  onRendererChanged(renderer) {\n    this.stageBounds = this._stageBounds;\n  }\n\n  get stageBounds() {\n    return this._stageBounds;\n  }\n\n  set stageBounds(stageBounds) {\n    if (this._stageBounds) {\n      this.clearRenderPrimitives();\n    }\n    this._stageBounds = stageBounds;\n    if (!stageBounds || stageBounds.length === 0 || !this._renderer) {\n      return;\n    }\n\n    let verts = [];\n    let indices = [];\n\n    // Tessellate the bounding points from XRStageBounds and connect\n    // each point to a neighbor and 0,0,0.\n    const pointCount = stageBounds.geometry.length;\n    for (let i = 0; i < pointCount; i++) {\n      const point = stageBounds.geometry[i];\n      verts.push(point.x, 0, point.z);\n      indices.push(i, i === 0 ? pointCount - 1 : i - 1, pointCount);\n    }\n    // Center point\n    verts.push(0, 0, 0);\n\n    let vertexBuffer = this._renderer.createRenderBuffer(GL.ARRAY_BUFFER, new Float32Array(verts));\n    let indexBuffer = this._renderer.createRenderBuffer(GL.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices));\n\n    let attribs = [\n      new PrimitiveAttribute('POSITION', vertexBuffer, 3, GL.FLOAT, 12, 0),\n    ];\n\n    let primitive = new Primitive(attribs, indices.length);\n    primitive.setIndexBuffer(indexBuffer);\n\n    let renderPrimitive = this._renderer.createRenderPrimitive(primitive, new BoundsMaterial());\n    this.addRenderPrimitive(renderPrimitive);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/bounds-renderer.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\nimport {Material, RENDER_ORDER} from '../core/material.js';\nimport {Node} from '../core/node.js';\nimport {Primitive, PrimitiveAttribute} from '../core/primitive.js';\nimport {DataTexture} from '../core/texture.js';\n\nconst GL = WebGLRenderingContext; // For enums\n\n// Laser texture data, 48x1 RGBA (not premultiplied alpha). This represents a\n// \"cross section\" of the laser beam with a bright core and a feathered edge.\n// Borrowed from Chromium source code.\nconst LASER_TEXTURE_DATA = new Uint8Array([\n0xff, 0xff, 0xff, 0x01, 0xff, 0xff, 0xff, 0x02, 0xbf, 0xbf, 0xbf, 0x04, 0xcc, 0xcc, 0xcc, 0x05,\n0xdb, 0xdb, 0xdb, 0x07, 0xcc, 0xcc, 0xcc, 0x0a, 0xd8, 0xd8, 0xd8, 0x0d, 0xd2, 0xd2, 0xd2, 0x11,\n0xce, 0xce, 0xce, 0x15, 0xce, 0xce, 0xce, 0x1a, 0xce, 0xce, 0xce, 0x1f, 0xcd, 0xcd, 0xcd, 0x24,\n0xc8, 0xc8, 0xc8, 0x2a, 0xc9, 0xc9, 0xc9, 0x2f, 0xc9, 0xc9, 0xc9, 0x34, 0xc9, 0xc9, 0xc9, 0x39,\n0xc9, 0xc9, 0xc9, 0x3d, 0xc8, 0xc8, 0xc8, 0x41, 0xcb, 0xcb, 0xcb, 0x44, 0xee, 0xee, 0xee, 0x87,\n0xfa, 0xfa, 0xfa, 0xc8, 0xf9, 0xf9, 0xf9, 0xc9, 0xf9, 0xf9, 0xf9, 0xc9, 0xfa, 0xfa, 0xfa, 0xc9,\n0xfa, 0xfa, 0xfa, 0xc9, 0xf9, 0xf9, 0xf9, 0xc9, 0xf9, 0xf9, 0xf9, 0xc9, 0xfa, 0xfa, 0xfa, 0xc8,\n0xee, 0xee, 0xee, 0x87, 0xcb, 0xcb, 0xcb, 0x44, 0xc8, 0xc8, 0xc8, 0x41, 0xc9, 0xc9, 0xc9, 0x3d,\n0xc9, 0xc9, 0xc9, 0x39, 0xc9, 0xc9, 0xc9, 0x34, 0xc9, 0xc9, 0xc9, 0x2f, 0xc8, 0xc8, 0xc8, 0x2a,\n0xcd, 0xcd, 0xcd, 0x24, 0xce, 0xce, 0xce, 0x1f, 0xce, 0xce, 0xce, 0x1a, 0xce, 0xce, 0xce, 0x15,\n0xd2, 0xd2, 0xd2, 0x11, 0xd8, 0xd8, 0xd8, 0x0d, 0xcc, 0xcc, 0xcc, 0x0a, 0xdb, 0xdb, 0xdb, 0x07,\n0xcc, 0xcc, 0xcc, 0x05, 0xbf, 0xbf, 0xbf, 0x04, 0xff, 0xff, 0xff, 0x02, 0xff, 0xff, 0xff, 0x01,\n]);\n\nconst LASER_LENGTH = 1.0;\nconst LASER_DIAMETER = 0.01;\nconst LASER_FADE_END = 0.535;\nconst LASER_FADE_POINT = 0.5335;\nconst LASER_DEFAULT_COLOR = [1.0, 1.0, 1.0, 0.25];\n\nconst CURSOR_RADIUS = 0.004;\nconst CURSOR_SHADOW_RADIUS = 0.007;\nconst CURSOR_SHADOW_INNER_LUMINANCE = 0.5;\nconst CURSOR_SHADOW_OUTER_LUMINANCE = 0.0;\nconst CURSOR_SHADOW_INNER_OPACITY = 0.75;\nconst CURSOR_SHADOW_OUTER_OPACITY = 0.0;\nconst CURSOR_OPACITY = 0.9;\nconst CURSOR_SEGMENTS = 16;\nconst CURSOR_DEFAULT_COLOR = [1.0, 1.0, 1.0, 1.0];\nconst CURSOR_DEFAULT_HIDDEN_COLOR = [0.5, 0.5, 0.5, 0.25];\n\nconst DEFAULT_RESET_OPTIONS = {\n  controllers: true,\n  lasers: true,\n  cursors: true,\n};\n\nclass LaserMaterial extends Material {\n  constructor() {\n    super();\n    this.renderOrder = RENDER_ORDER.ADDITIVE;\n    this.state.cullFace = false;\n    this.state.blend = true;\n    this.state.blendFuncSrc = GL.ONE;\n    this.state.blendFuncDst = GL.ONE;\n    this.state.depthMask = false;\n\n    this.laser = this.defineSampler('diffuse');\n    this.laser.texture = new DataTexture(LASER_TEXTURE_DATA, 48, 1);\n    this.laserColor = this.defineUniform('laserColor', LASER_DEFAULT_COLOR);\n  }\n\n  get materialName() {\n    return 'INPUT_LASER';\n  }\n\n  get vertexSource() {\n    return `\n    attribute vec3 POSITION;\n    attribute vec2 TEXCOORD_0;\n\n    varying vec2 vTexCoord;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vTexCoord = TEXCOORD_0;\n      return proj * view * model * vec4(POSITION, 1.0);\n    }`;\n  }\n\n  get fragmentSource() {\n    return `\n    precision mediump float;\n\n    uniform vec4 laserColor;\n    uniform sampler2D diffuse;\n    varying vec2 vTexCoord;\n\n    const float fadePoint = ${LASER_FADE_POINT};\n    const float fadeEnd = ${LASER_FADE_END};\n\n    vec4 fragment_main() {\n      vec2 uv = vTexCoord;\n      float front_fade_factor = 1.0 - clamp(1.0 - (uv.y - fadePoint) / (1.0 - fadePoint), 0.0, 1.0);\n      float back_fade_factor = clamp((uv.y - fadePoint) / (fadeEnd - fadePoint), 0.0, 1.0);\n      vec4 color = laserColor * texture2D(diffuse, vTexCoord);\n      float opacity = color.a * front_fade_factor * back_fade_factor;\n      return vec4(color.rgb * opacity, opacity);\n    }`;\n  }\n}\n\nconst CURSOR_VERTEX_SHADER = `\nattribute vec4 POSITION;\n\nvarying float vLuminance;\nvarying float vOpacity;\n\nvec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n  vLuminance = POSITION.z;\n  vOpacity = POSITION.w;\n\n  // Billboarded, constant size vertex transform.\n  vec4 screenPos = proj * view * model * vec4(0.0, 0.0, 0.0, 1.0);\n  screenPos /= screenPos.w;\n  screenPos.xy += POSITION.xy;\n  return screenPos;\n}`;\n\nconst CURSOR_FRAGMENT_SHADER = `\nprecision mediump float;\n\nuniform vec4 cursorColor;\nvarying float vLuminance;\nvarying float vOpacity;\n\nvec4 fragment_main() {\n  vec3 color = cursorColor.rgb * vLuminance;\n  float opacity = cursorColor.a * vOpacity;\n  return vec4(color * opacity, opacity);\n}`;\n\n// Cursors are drawn as billboards that always face the camera and are rendered\n// as a fixed size no matter how far away they are.\nclass CursorMaterial extends Material {\n  constructor() {\n    super();\n    this.renderOrder = RENDER_ORDER.ADDITIVE;\n    this.state.cullFace = false;\n    this.state.blend = true;\n    this.state.blendFuncSrc = GL.ONE;\n    this.state.depthMask = false;\n\n    this.cursorColor = this.defineUniform('cursorColor', CURSOR_DEFAULT_COLOR);\n  }\n\n  get materialName() {\n    return 'INPUT_CURSOR';\n  }\n\n  get vertexSource() {\n    return CURSOR_VERTEX_SHADER;\n  }\n\n  get fragmentSource() {\n    return CURSOR_FRAGMENT_SHADER;\n  }\n}\n\nclass CursorHiddenMaterial extends Material {\n  constructor() {\n    super();\n    this.renderOrder = RENDER_ORDER.ADDITIVE;\n    this.state.cullFace = false;\n    this.state.blend = true;\n    this.state.blendFuncSrc = GL.ONE;\n    this.state.depthFunc = GL.GEQUAL;\n    this.state.depthMask = false;\n\n    this.cursorColor = this.defineUniform('cursorColor', CURSOR_DEFAULT_HIDDEN_COLOR);\n  }\n\n  // TODO: Rename to \"program_name\"\n  get materialName() {\n    return 'INPUT_CURSOR_2';\n  }\n\n  get vertexSource() {\n    return CURSOR_VERTEX_SHADER;\n  }\n\n  get fragmentSource() {\n    return CURSOR_FRAGMENT_SHADER;\n  }\n}\n\nexport class InputRenderer extends Node {\n  constructor() {\n    super();\n\n    this._maxInputElements = 32;\n\n    this._controllers = [];\n    this._controllerNode = null;\n    this._controllerNodeHandedness = null;\n    this._lasers = null;\n    this._cursors = null;\n\n    this._activeControllers = 0;\n    this._activeLasers = 0;\n    this._activeCursors = 0;\n  }\n\n  onRendererChanged(renderer) {\n    this._controllers = [];\n    this._controllerNode = null;\n    this._controllerNodeHandedness = null;\n    this._lasers = null;\n    this._cursors = null;\n\n    this._activeControllers = 0;\n    this._activeLasers = 0;\n    this._activeCursors = 0;\n  }\n\n  setControllerMesh(controllerNode, handedness = 'right') {\n    this._controllerNode = controllerNode;\n    this._controllerNode.visible = false;\n    // FIXME: Temporary fix to initialize for cloning.\n    this.addNode(this._controllerNode);\n    this._controllerNodeHandedness = handedness;\n  }\n\n  addController(gripMatrix) {\n    if (!this._controllerNode) {\n        return;\n    }\n\n    let controller = null;\n    if (this._activeControllers < this._controllers.length) {\n      controller = this._controllers[this._activeControllers];\n    } else {\n      controller = this._controllerNode.clone();\n      this.addNode(controller);\n      this._controllers.push(controller);\n    }\n    this._activeControllers = (this._activeControllers + 1) % this._maxInputElements;\n\n    controller.matrix = gripMatrix;\n    controller.visible = true;\n  }\n\n  addLaserPointer(pointerMatrix) {\n    // Create the laser pointer mesh if needed.\n    if (!this._lasers && this._renderer) {\n      this._lasers = [this._createLaserMesh()];\n      this.addNode(this._lasers[0]);\n    }\n\n    let laser = null;\n    if (this._activeLasers < this._lasers.length) {\n      laser = this._lasers[this._activeLasers];\n    } else {\n      laser = this._lasers[0].clone();\n      this.addNode(laser);\n      this._lasers.push(laser);\n    }\n    this._activeLasers = (this._activeLasers + 1) % this._maxInputElements;\n\n    laser.matrix = pointerMatrix;\n    laser.visible = true;\n  }\n\n  addCursor(cursorPos) {\n    // Create the cursor mesh if needed.\n    if (!this._cursors && this._renderer) {\n      this._cursors = [this._createCursorMesh()];\n      this.addNode(this._cursors[0]);\n    }\n\n    let cursor = null;\n    if (this._activeCursors < this._cursors.length) {\n      cursor = this._cursors[this._activeCursors];\n    } else {\n      cursor = this._cursors[0].clone();\n      this.addNode(cursor);\n      this._cursors.push(cursor);\n    }\n    this._activeCursors = (this._activeCursors + 1) % this._maxInputElements;\n\n    cursor.translation = cursorPos;\n    cursor.visible = true;\n  }\n\n  reset(options) {\n    if (!options) {\n      options = DEFAULT_RESET_OPTIONS;\n    }\n    if (this._controllers && options.controllers) {\n      for (let controller of this._controllers) {\n        controller.visible = false;\n      }\n      this._activeControllers = 0;\n    }\n    if (this._lasers && options.lasers) {\n      for (let laser of this._lasers) {\n        laser.visible = false;\n      }\n      this._activeLasers = 0;\n    }\n    if (this._cursors && options.cursors) {\n      for (let cursor of this._cursors) {\n        cursor.visible = false;\n      }\n      this._activeCursors = 0;\n    }\n  }\n\n  _createLaserMesh() {\n    let gl = this._renderer._gl;\n\n    let lr = LASER_DIAMETER * 0.5;\n    let ll = LASER_LENGTH;\n\n    // Laser is rendered as cross-shaped beam\n    let laserVerts = [\n    // X    Y   Z    U    V\n      0.0, lr, 0.0, 0.0, 1.0,\n      0.0, lr, -ll, 0.0, 0.0,\n      0.0, -lr, 0.0, 1.0, 1.0,\n      0.0, -lr, -ll, 1.0, 0.0,\n\n      lr, 0.0, 0.0, 0.0, 1.0,\n      lr, 0.0, -ll, 0.0, 0.0,\n      -lr, 0.0, 0.0, 1.0, 1.0,\n      -lr, 0.0, -ll, 1.0, 0.0,\n\n      0.0, -lr, 0.0, 0.0, 1.0,\n      0.0, -lr, -ll, 0.0, 0.0,\n      0.0, lr, 0.0, 1.0, 1.0,\n      0.0, lr, -ll, 1.0, 0.0,\n\n      -lr, 0.0, 0.0, 0.0, 1.0,\n      -lr, 0.0, -ll, 0.0, 0.0,\n      lr, 0.0, 0.0, 1.0, 1.0,\n      lr, 0.0, -ll, 1.0, 0.0,\n    ];\n    let laserIndices = [\n      0, 1, 2, 1, 3, 2,\n      4, 5, 6, 5, 7, 6,\n      8, 9, 10, 9, 11, 10,\n      12, 13, 14, 13, 15, 14,\n    ];\n\n    let laserVertexBuffer = this._renderer.createRenderBuffer(gl.ARRAY_BUFFER, new Float32Array(laserVerts));\n    let laserIndexBuffer = this._renderer.createRenderBuffer(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(laserIndices));\n\n    let laserIndexCount = laserIndices.length;\n\n    let laserAttribs = [\n      new PrimitiveAttribute('POSITION', laserVertexBuffer, 3, gl.FLOAT, 20, 0),\n      new PrimitiveAttribute('TEXCOORD_0', laserVertexBuffer, 2, gl.FLOAT, 20, 12),\n    ];\n\n    let laserPrimitive = new Primitive(laserAttribs, laserIndexCount);\n    laserPrimitive.setIndexBuffer(laserIndexBuffer);\n\n    let laserMaterial = new LaserMaterial();\n\n    let laserRenderPrimitive = this._renderer.createRenderPrimitive(laserPrimitive, laserMaterial);\n    let meshNode = new Node();\n    meshNode.addRenderPrimitive(laserRenderPrimitive);\n    return meshNode;\n  }\n\n  _createCursorMesh() {\n    let gl = this._renderer._gl;\n\n    // Cursor is a circular white dot with a dark \"shadow\" skirt around the edge\n    // that fades from black to transparent as it moves out from the center.\n    // Cursor verts are packed as [X, Y, Luminance, Opacity]\n    let cursorVerts = [];\n    let cursorIndices = [];\n\n    let segRad = (2.0 * Math.PI) / CURSOR_SEGMENTS;\n\n    // Cursor center\n    for (let i = 0; i < CURSOR_SEGMENTS; ++i) {\n      let rad = i * segRad;\n      let x = Math.cos(rad);\n      let y = Math.sin(rad);\n      cursorVerts.push(x * CURSOR_RADIUS, y * CURSOR_RADIUS, 1.0, CURSOR_OPACITY);\n\n      if (i > 1) {\n        cursorIndices.push(0, i-1, i);\n      }\n    }\n\n    let indexOffset = CURSOR_SEGMENTS;\n\n    // Cursor Skirt\n    for (let i = 0; i < CURSOR_SEGMENTS; ++i) {\n      let rad = i * segRad;\n      let x = Math.cos(rad);\n      let y = Math.sin(rad);\n      cursorVerts.push(x * CURSOR_RADIUS, y * CURSOR_RADIUS,\n          CURSOR_SHADOW_INNER_LUMINANCE, CURSOR_SHADOW_INNER_OPACITY);\n      cursorVerts.push(x * CURSOR_SHADOW_RADIUS, y * CURSOR_SHADOW_RADIUS,\n          CURSOR_SHADOW_OUTER_LUMINANCE, CURSOR_SHADOW_OUTER_OPACITY);\n\n      if (i > 0) {\n        let idx = indexOffset + (i * 2);\n        cursorIndices.push(idx-2, idx-1, idx);\n        cursorIndices.push(idx-1, idx+1, idx);\n      }\n    }\n\n    let idx = indexOffset + (CURSOR_SEGMENTS * 2);\n    cursorIndices.push(idx-2, idx-1, indexOffset);\n    cursorIndices.push(idx-1, indexOffset+1, indexOffset);\n\n    let cursorVertexBuffer = this._renderer.createRenderBuffer(gl.ARRAY_BUFFER, new Float32Array(cursorVerts));\n    let cursorIndexBuffer = this._renderer.createRenderBuffer(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(cursorIndices));\n\n    let cursorIndexCount = cursorIndices.length;\n\n    let cursorAttribs = [\n      new PrimitiveAttribute('POSITION', cursorVertexBuffer, 4, gl.FLOAT, 16, 0),\n    ];\n\n    let cursorPrimitive = new Primitive(cursorAttribs, cursorIndexCount);\n    cursorPrimitive.setIndexBuffer(cursorIndexBuffer);\n\n    let cursorMaterial = new CursorMaterial();\n    let cursorHiddenMaterial = new CursorHiddenMaterial();\n\n    // Cursor renders two parts: The bright opaque cursor for areas where it's\n    // not obscured and a more transparent, darker version for areas where it's\n    // behind another object.\n    let cursorRenderPrimitive = this._renderer.createRenderPrimitive(cursorPrimitive, cursorMaterial);\n    let cursorHiddenRenderPrimitive = this._renderer.createRenderPrimitive(cursorPrimitive, cursorHiddenMaterial);\n    let meshNode = new Node();\n    meshNode.addRenderPrimitive(cursorRenderPrimitive);\n    meshNode.addRenderPrimitive(cursorHiddenRenderPrimitive);\n    return meshNode;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/input-renderer.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nHeavily inspired by Mr. Doobs stats.js, this FPS counter is rendered completely\nwith WebGL, allowing it to be shown in cases where overlaid HTML elements aren't\nusable (like WebXR), or if you want the FPS counter to be rendered as part of\nyour scene.\n*/\n\nimport {Material} from '../core/material.js';\nimport {Node} from '../core/node.js';\nimport {Primitive, PrimitiveAttribute} from '../core/primitive.js';\nimport {SevenSegmentText} from './seven-segment-text.js';\n\nconst SEGMENTS = 30;\nconst MAX_FPS = 90;\n\nclass StatsMaterial extends Material {\n  get materialName() {\n    return 'STATS_VIEWER';\n  }\n\n  get vertexSource() {\n    return `\n    attribute vec3 POSITION;\n    attribute vec3 COLOR_0;\n    varying vec4 vColor;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      vColor = vec4(COLOR_0, 1.0);\n      return proj * view * model * vec4(POSITION, 1.0);\n    }`;\n  }\n\n  get fragmentSource() {\n    return `\n    precision mediump float;\n    varying vec4 vColor;\n\n    vec4 fragment_main() {\n      return vColor;\n    }`;\n  }\n}\n\nfunction segmentToX(i) {\n  return ((0.9/SEGMENTS) * i) - 0.45;\n}\n\nfunction fpsToY(value) {\n  return (Math.min(value, MAX_FPS) * (0.7 / MAX_FPS)) - 0.45;\n}\n\nfunction fpsToRGB(value) {\n  return {\n    r: Math.max(0.0, Math.min(1.0, 1.0 - (value/60))),\n    g: Math.max(0.0, Math.min(1.0, ((value-15)/(MAX_FPS-15)))),\n    b: Math.max(0.0, Math.min(1.0, ((value-15)/(MAX_FPS-15)))),\n  };\n}\n\nlet now = (window.performance && performance.now) ? performance.now.bind(performance) : Date.now;\n\nexport class StatsViewer extends Node {\n  constructor() {\n    super();\n\n    this._performanceMonitoring = false;\n\n    this._startTime = now();\n    this._prevFrameTime = this._startTime;\n    this._prevGraphUpdateTime = this._startTime;\n    this._frames = 0;\n    this._fpsAverage = 0;\n    this._fpsMin = 0;\n    this._fpsStep = this._performanceMonitoring ? 1000 : 250;\n    this._lastSegment = 0;\n\n    this._fpsVertexBuffer = null;\n    this._fpsRenderPrimitive = null;\n    this._fpsNode = null;\n\n    this._sevenSegmentNode = new SevenSegmentText();\n    // Hard coded because it doesn't change:\n    // Scale by 0.075 in X and Y\n    // Translate into upper left corner w/ z = 0.02\n    this._sevenSegmentNode.matrix = new Float32Array([\n      0.075, 0, 0, 0,\n      0, 0.075, 0, 0,\n      0, 0, 1, 0,\n      -0.3625, 0.3625, 0.02, 1,\n    ]);\n  }\n\n  onRendererChanged(renderer) {\n    this.clearNodes();\n\n    let gl = renderer.gl;\n\n    let fpsVerts = [];\n    let fpsIndices = [];\n\n    // Graph geometry\n    for (let i = 0; i < SEGMENTS; ++i) {\n      // Bar top\n      fpsVerts.push(segmentToX(i), fpsToY(0), 0.02, 0.0, 1.0, 1.0);\n      fpsVerts.push(segmentToX(i+1), fpsToY(0), 0.02, 0.0, 1.0, 1.0);\n\n      // Bar bottom\n      fpsVerts.push(segmentToX(i), fpsToY(0), 0.02, 0.0, 1.0, 1.0);\n      fpsVerts.push(segmentToX(i+1), fpsToY(0), 0.02, 0.0, 1.0, 1.0);\n\n      let idx = i * 4;\n      fpsIndices.push(idx, idx+3, idx+1,\n                       idx+3, idx, idx+2);\n    }\n\n    function addBGSquare(left, bottom, right, top, z, r, g, b) {\n      let idx = fpsVerts.length / 6;\n\n      fpsVerts.push(left, bottom, z, r, g, b);\n      fpsVerts.push(right, top, z, r, g, b);\n      fpsVerts.push(left, top, z, r, g, b);\n      fpsVerts.push(right, bottom, z, r, g, b);\n\n      fpsIndices.push(idx, idx+1, idx+2,\n                       idx, idx+3, idx+1);\n    }\n\n    // Panel Background\n    addBGSquare(-0.5, -0.5, 0.5, 0.5, 0.0, 0.0, 0.0, 0.125);\n\n    // FPS Background\n    addBGSquare(-0.45, -0.45, 0.45, 0.25, 0.01, 0.0, 0.0, 0.4);\n\n    // 30 FPS line\n    addBGSquare(-0.45, fpsToY(30), 0.45, fpsToY(32), 0.015, 0.5, 0.0, 0.5);\n\n    // 60 FPS line\n    addBGSquare(-0.45, fpsToY(60), 0.45, fpsToY(62), 0.015, 0.2, 0.0, 0.75);\n\n    this._fpsVertexBuffer = renderer.createRenderBuffer(gl.ARRAY_BUFFER, new Float32Array(fpsVerts), gl.DYNAMIC_DRAW);\n    let fpsIndexBuffer = renderer.createRenderBuffer(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(fpsIndices));\n\n    let fpsAttribs = [\n      new PrimitiveAttribute('POSITION', this._fpsVertexBuffer, 3, gl.FLOAT, 24, 0),\n      new PrimitiveAttribute('COLOR_0', this._fpsVertexBuffer, 3, gl.FLOAT, 24, 12),\n    ];\n\n    let fpsPrimitive = new Primitive(fpsAttribs, fpsIndices.length);\n    fpsPrimitive.setIndexBuffer(fpsIndexBuffer);\n    fpsPrimitive.setBounds([-0.5, -0.5, 0.0], [0.5, 0.5, 0.015]);\n\n    this._fpsRenderPrimitive = renderer.createRenderPrimitive(fpsPrimitive, new StatsMaterial());\n    this._fpsNode = new Node();\n    this._fpsNode.addRenderPrimitive(this._fpsRenderPrimitive);\n\n    this.addNode(this._fpsNode);\n    this.addNode(this._sevenSegmentNode);\n  }\n\n  get performanceMonitoring() {\n    return this._performanceMonitoring;\n  }\n\n  set performanceMonitoring(value) {\n    this._performanceMonitoring = value;\n    this._fpsStep = value ? 1000 : 250;\n  }\n\n  begin() {\n    this._startTime = now();\n  }\n\n  end() {\n    let time = now();\n\n    let frameFps = 1000 / (time - this._prevFrameTime);\n    this._prevFrameTime = time;\n    this._fpsMin = this._frames ? Math.min(this._fpsMin, frameFps) : frameFps;\n    this._frames++;\n\n    if (time > this._prevGraphUpdateTime + this._fpsStep) {\n      let intervalTime = time - this._prevGraphUpdateTime;\n      this._fpsAverage = Math.round(1000 / (intervalTime / this._frames));\n\n      // Draw both average and minimum FPS for this period\n      // so that dropped frames are more clearly visible.\n      this._updateGraph(this._fpsMin, this._fpsAverage);\n      if (this._performanceMonitoring) {\n        console.log(`Average FPS: ${this._fpsAverage} Min FPS: ${this._fpsMin}`);\n      }\n\n      this._prevGraphUpdateTime = time;\n      this._frames = 0;\n      this._fpsMin = 0;\n    }\n  }\n\n  _updateGraph(valueLow, valueHigh) {\n    let color = fpsToRGB(valueLow);\n    // Draw a range from the low to high value. Artificially widen the\n    // range a bit to ensure that near-equal values still remain\n    // visible - the logic here should match that used by the\n    // \"60 FPS line\" setup below. Hitting 60fps consistently will\n    // keep the top half of the 60fps background line visible.\n    let y0 = fpsToY(valueLow - 1);\n    let y1 = fpsToY(valueHigh + 1);\n\n    // Update the current segment with the new FPS value\n    let updateVerts = [\n      segmentToX(this._lastSegment), y1, 0.02, color.r, color.g, color.b,\n      segmentToX(this._lastSegment+1), y1, 0.02, color.r, color.g, color.b,\n      segmentToX(this._lastSegment), y0, 0.02, color.r, color.g, color.b,\n      segmentToX(this._lastSegment+1), y0, 0.02, color.r, color.g, color.b,\n    ];\n\n    // Re-shape the next segment into the green \"progress\" line\n    color.r = 0.2;\n    color.g = 1.0;\n    color.b = 0.2;\n\n    if (this._lastSegment == SEGMENTS - 1) {\n      // If we're updating the last segment we need to do two bufferSubDatas\n      // to update the segment and turn the first segment into the progress line.\n      this._renderer.updateRenderBuffer(this._fpsVertexBuffer, new Float32Array(updateVerts),\n                                        this._lastSegment * 24 * 4);\n      updateVerts = [\n        segmentToX(0), fpsToY(MAX_FPS), 0.02, color.r, color.g, color.b,\n        segmentToX(.25), fpsToY(MAX_FPS), 0.02, color.r, color.g, color.b,\n        segmentToX(0), fpsToY(0), 0.02, color.r, color.g, color.b,\n        segmentToX(.25), fpsToY(0), 0.02, color.r, color.g, color.b,\n      ];\n      this._renderer.updateRenderBuffer(this._fpsVertexBuffer, new Float32Array(updateVerts), 0);\n    } else {\n      updateVerts.push(\n        segmentToX(this._lastSegment+1), fpsToY(MAX_FPS), 0.02, color.r, color.g, color.b,\n        segmentToX(this._lastSegment+1.25), fpsToY(MAX_FPS), 0.02, color.r, color.g, color.b,\n        segmentToX(this._lastSegment+1), fpsToY(0), 0.02, color.r, color.g, color.b,\n        segmentToX(this._lastSegment+1.25), fpsToY(0), 0.02, color.r, color.g, color.b\n      );\n      this._renderer.updateRenderBuffer(this._fpsVertexBuffer, new Float32Array(updateVerts),\n                                        this._lastSegment * 24 * 4);\n    }\n\n    this._lastSegment = (this._lastSegment+1) % SEGMENTS;\n\n    this._sevenSegmentNode.text = `${this._fpsAverage} FP5`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/stats-viewer.js","// Copyright 2018 The Immersive Web Community Group\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n// SOFTWARE.\n\n/*\nRenders simple text using a seven-segment LED style pattern. Only really good\nfor numbers and a limited number of other characters.\n*/\n\nimport {Material} from '../core/material.js';\nimport {Node} from '../core/node.js';\nimport {Primitive, PrimitiveAttribute} from '../core/primitive.js';\n\nconst TEXT_KERNING = 2.0;\n\nclass SevenSegmentMaterial extends Material {\n  get materialName() {\n    return 'SEVEN_SEGMENT_TEXT';\n  }\n\n  get vertexSource() {\n    return `\n    attribute vec2 POSITION;\n\n    vec4 vertex_main(mat4 proj, mat4 view, mat4 model) {\n      return proj * view * model * vec4(POSITION, 0.0, 1.0);\n    }`;\n  }\n\n  get fragmentSource() {\n    return `\n    precision mediump float;\n    const vec4 color = vec4(0.0, 1.0, 0.0, 1.0);\n\n    vec4 fragment_main() {\n      return color;\n    }`;\n  }\n}\n\nexport class SevenSegmentText extends Node {\n  constructor() {\n    super();\n\n    this._text = '';\n    this._charNodes = [];\n  }\n\n  onRendererChanged(renderer) {\n    this.clearNodes();\n    this._charNodes = [];\n\n    let vertices = [];\n    let segmentIndices = {};\n    let indices = [];\n\n    const width = 0.5;\n    const thickness = 0.25;\n\n    function defineSegment(id, left, top, right, bottom) {\n      let idx = vertices.length / 2;\n      vertices.push(\n          left, top,\n          right, top,\n          right, bottom,\n          left, bottom);\n\n      segmentIndices[id] = [\n        idx, idx+2, idx+1,\n        idx, idx+3, idx+2,\n      ];\n    }\n\n    let characters = {};\n    function defineCharacter(c, segments) {\n      let character = {\n        character: c,\n        offset: indices.length * 2,\n        count: 0,\n      };\n\n      for (let i = 0; i < segments.length; ++i) {\n        let idx = segments[i];\n        let segment = segmentIndices[idx];\n        character.count += segment.length;\n        indices.push(...segment);\n      }\n\n      characters[c] = character;\n    }\n\n    /* Segment layout is as follows:\n\n    |-0-|\n    3   4\n    |-1-|\n    5   6\n    |-2-|\n\n    */\n\n    defineSegment(0, -1, 1, width, 1-thickness);\n    defineSegment(1, -1, thickness*0.5, width, -thickness*0.5);\n    defineSegment(2, -1, -1+thickness, width, -1);\n    defineSegment(3, -1, 1, -1+thickness, -thickness*0.5);\n    defineSegment(4, width-thickness, 1, width, -thickness*0.5);\n    defineSegment(5, -1, thickness*0.5, -1+thickness, -1);\n    defineSegment(6, width-thickness, thickness*0.5, width, -1);\n\n\n    defineCharacter('0', [0, 2, 3, 4, 5, 6]);\n    defineCharacter('1', [4, 6]);\n    defineCharacter('2', [0, 1, 2, 4, 5]);\n    defineCharacter('3', [0, 1, 2, 4, 6]);\n    defineCharacter('4', [1, 3, 4, 6]);\n    defineCharacter('5', [0, 1, 2, 3, 6]);\n    defineCharacter('6', [0, 1, 2, 3, 5, 6]);\n    defineCharacter('7', [0, 4, 6]);\n    defineCharacter('8', [0, 1, 2, 3, 4, 5, 6]);\n    defineCharacter('9', [0, 1, 2, 3, 4, 6]);\n    defineCharacter('A', [0, 1, 3, 4, 5, 6]);\n    defineCharacter('B', [1, 2, 3, 5, 6]);\n    defineCharacter('C', [0, 2, 3, 5]);\n    defineCharacter('D', [1, 2, 4, 5, 6]);\n    defineCharacter('E', [0, 1, 2, 4, 6]);\n    defineCharacter('F', [0, 1, 3, 5]);\n    defineCharacter('P', [0, 1, 3, 4, 5]);\n    defineCharacter('-', [1]);\n    defineCharacter(' ', []);\n    defineCharacter('_', [2]); // Used for undefined characters\n\n    let gl = renderer.gl;\n    let vertexBuffer = renderer.createRenderBuffer(gl.ARRAY_BUFFER, new Float32Array(vertices));\n    let indexBuffer = renderer.createRenderBuffer(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices));\n\n    let vertexAttribs = [\n      new PrimitiveAttribute('POSITION', vertexBuffer, 2, gl.FLOAT, 8, 0),\n    ];\n\n    let primitive = new Primitive(vertexAttribs, indices.length);\n    primitive.setIndexBuffer(indexBuffer);\n\n    let material = new SevenSegmentMaterial();\n\n    this._charPrimitives = {};\n    for (let char in characters) {\n      let charDef = characters[char];\n      primitive.elementCount = charDef.count;\n      primitive.indexByteOffset = charDef.offset;\n      this._charPrimitives[char] = renderer.createRenderPrimitive(primitive, material);\n    }\n\n    this.text = this._text;\n  }\n\n  get text() {\n    return this._text;\n  }\n\n  set text(value) {\n    this._text = value;\n\n    let i = 0;\n    let charPrimitive = null;\n    for (; i < value.length; ++i) {\n      if (value[i] in this._charPrimitives) {\n        charPrimitive = this._charPrimitives[value[i]];\n      } else {\n        charPrimitive = this._charPrimitives['_'];\n      }\n\n      if (this._charNodes.length <= i) {\n        let node = new Node();\n        node.addRenderPrimitive(charPrimitive);\n        let offset = i * TEXT_KERNING;\n        node.translation = [offset, 0, 0];\n        this._charNodes.push(node);\n        this.addNode(node);\n      } else {\n        // This is sort of an abuse of how these things are expected to work,\n        // but it's the cheapest thing I could think of that didn't break the\n        // world.\n        this._charNodes[i].clearRenderPrimitives();\n        this._charNodes[i].addRenderPrimitive(charPrimitive);\n        this._charNodes[i].visible = true;\n      }\n    }\n\n    // If there's any nodes left over make them invisible\n    for (; i < this._charNodes.length; ++i) {\n      this._charNodes[i].visible = false;\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nodes/seven-segment-text.js"],"sourceRoot":""}